(()=>{"use strict";var __webpack_modules__={"./node_modules/fast-average-color/dist/index.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   FastAverageColor: () => (/* binding */ FastAverageColor)\n/* harmony export */ });\n/*! Fast Average Color | © 2025 Denis Seleznev | MIT License | https://github.com/fast-average-color/fast-average-color */\nfunction toHex(num) {\n    var str = num.toString(16);\n    return str.length === 1 ? '0' + str : str;\n}\nfunction arrayToHex(arr) {\n    return '#' + arr.map(toHex).join('');\n}\nfunction isDark(color) {\n    // http://www.w3.org/TR/AERT#color-contrast\n    var result = (color[0] * 299 + color[1] * 587 + color[2] * 114) / 1000;\n    return result < 128;\n}\nfunction prepareIgnoredColor(color) {\n    if (!color) {\n        return [];\n    }\n    return isRGBArray(color) ? color : [color];\n}\nfunction isRGBArray(value) {\n    return Array.isArray(value[0]);\n}\nfunction isIgnoredColor(data, index, ignoredColor) {\n    for (var i = 0; i < ignoredColor.length; i++) {\n        if (isIgnoredColorAsNumbers(data, index, ignoredColor[i])) {\n            return true;\n        }\n    }\n    return false;\n}\nfunction isIgnoredColorAsNumbers(data, index, ignoredColor) {\n    switch (ignoredColor.length) {\n        case 3:\n            // [red, green, blue]\n            if (isIgnoredRGBColor(data, index, ignoredColor)) {\n                return true;\n            }\n            break;\n        case 4:\n            // [red, green, blue, alpha]\n            if (isIgnoredRGBAColor(data, index, ignoredColor)) {\n                return true;\n            }\n            break;\n        case 5:\n            // [red, green, blue, alpha, threshold]\n            if (isIgnoredRGBAColorWithThreshold(data, index, ignoredColor)) {\n                return true;\n            }\n            break;\n        default:\n            return false;\n    }\n}\nfunction isIgnoredRGBColor(data, index, ignoredColor) {\n    // Ignore if the pixel are transparent.\n    if (data[index + 3] !== 255) {\n        return true;\n    }\n    if (data[index] === ignoredColor[0] &&\n        data[index + 1] === ignoredColor[1] &&\n        data[index + 2] === ignoredColor[2]) {\n        return true;\n    }\n    return false;\n}\nfunction isIgnoredRGBAColor(data, index, ignoredColor) {\n    if (data[index + 3] && ignoredColor[3]) {\n        return data[index] === ignoredColor[0] &&\n            data[index + 1] === ignoredColor[1] &&\n            data[index + 2] === ignoredColor[2] &&\n            data[index + 3] === ignoredColor[3];\n    }\n    // Ignore rgb components if the pixel are fully transparent.\n    return data[index + 3] === ignoredColor[3];\n}\nfunction inRange(colorComponent, ignoredColorComponent, value) {\n    return colorComponent >= (ignoredColorComponent - value) &&\n        colorComponent <= (ignoredColorComponent + value);\n}\nfunction isIgnoredRGBAColorWithThreshold(data, index, ignoredColor) {\n    var redIgnored = ignoredColor[0];\n    var greenIgnored = ignoredColor[1];\n    var blueIgnored = ignoredColor[2];\n    var alphaIgnored = ignoredColor[3];\n    var threshold = ignoredColor[4];\n    var alphaData = data[index + 3];\n    var alphaInRange = inRange(alphaData, alphaIgnored, threshold);\n    if (!alphaIgnored) {\n        return alphaInRange;\n    }\n    if (!alphaData && alphaInRange) {\n        return true;\n    }\n    if (inRange(data[index], redIgnored, threshold) &&\n        inRange(data[index + 1], greenIgnored, threshold) &&\n        inRange(data[index + 2], blueIgnored, threshold) &&\n        alphaInRange) {\n        return true;\n    }\n    return false;\n}\n\nvar DEFAULT_DOMINANT_DIVIDER = 24;\nfunction dominantAlgorithm(arr, len, options) {\n    var colorHash = {};\n    var divider = options.dominantDivider || DEFAULT_DOMINANT_DIVIDER;\n    var ignoredColor = options.ignoredColor;\n    var step = options.step;\n    var max = [0, 0, 0, 0, 0];\n    for (var i = 0; i < len; i += step) {\n        var red = arr[i];\n        var green = arr[i + 1];\n        var blue = arr[i + 2];\n        var alpha = arr[i + 3];\n        if (ignoredColor && isIgnoredColor(arr, i, ignoredColor)) {\n            continue;\n        }\n        var key = Math.round(red / divider) + ',' +\n            Math.round(green / divider) + ',' +\n            Math.round(blue / divider);\n        if (colorHash[key]) {\n            colorHash[key] = [\n                colorHash[key][0] + red * alpha,\n                colorHash[key][1] + green * alpha,\n                colorHash[key][2] + blue * alpha,\n                colorHash[key][3] + alpha,\n                colorHash[key][4] + 1\n            ];\n        }\n        else {\n            colorHash[key] = [red * alpha, green * alpha, blue * alpha, alpha, 1];\n        }\n        if (max[4] < colorHash[key][4]) {\n            max = colorHash[key];\n        }\n    }\n    var redTotal = max[0];\n    var greenTotal = max[1];\n    var blueTotal = max[2];\n    var alphaTotal = max[3];\n    var count = max[4];\n    return alphaTotal ? [\n        Math.round(redTotal / alphaTotal),\n        Math.round(greenTotal / alphaTotal),\n        Math.round(blueTotal / alphaTotal),\n        Math.round(alphaTotal / count)\n    ] : options.defaultColor;\n}\n\nfunction simpleAlgorithm(arr, len, options) {\n    var redTotal = 0;\n    var greenTotal = 0;\n    var blueTotal = 0;\n    var alphaTotal = 0;\n    var count = 0;\n    var ignoredColor = options.ignoredColor;\n    var step = options.step;\n    for (var i = 0; i < len; i += step) {\n        var alpha = arr[i + 3];\n        var red = arr[i] * alpha;\n        var green = arr[i + 1] * alpha;\n        var blue = arr[i + 2] * alpha;\n        if (ignoredColor && isIgnoredColor(arr, i, ignoredColor)) {\n            continue;\n        }\n        redTotal += red;\n        greenTotal += green;\n        blueTotal += blue;\n        alphaTotal += alpha;\n        count++;\n    }\n    return alphaTotal ? [\n        Math.round(redTotal / alphaTotal),\n        Math.round(greenTotal / alphaTotal),\n        Math.round(blueTotal / alphaTotal),\n        Math.round(alphaTotal / count)\n    ] : options.defaultColor;\n}\n\nfunction sqrtAlgorithm(arr, len, options) {\n    var redTotal = 0;\n    var greenTotal = 0;\n    var blueTotal = 0;\n    var alphaTotal = 0;\n    var count = 0;\n    var ignoredColor = options.ignoredColor;\n    var step = options.step;\n    for (var i = 0; i < len; i += step) {\n        var red = arr[i];\n        var green = arr[i + 1];\n        var blue = arr[i + 2];\n        var alpha = arr[i + 3];\n        if (ignoredColor && isIgnoredColor(arr, i, ignoredColor)) {\n            continue;\n        }\n        redTotal += red * red * alpha;\n        greenTotal += green * green * alpha;\n        blueTotal += blue * blue * alpha;\n        alphaTotal += alpha;\n        count++;\n    }\n    return alphaTotal ? [\n        Math.round(Math.sqrt(redTotal / alphaTotal)),\n        Math.round(Math.sqrt(greenTotal / alphaTotal)),\n        Math.round(Math.sqrt(blueTotal / alphaTotal)),\n        Math.round(alphaTotal / count)\n    ] : options.defaultColor;\n}\n\nfunction getDefaultColor(options) {\n    return getOption(options, 'defaultColor', [0, 0, 0, 0]);\n}\nfunction getOption(options, name, defaultValue) {\n    return (options[name] === undefined ? defaultValue : options[name]);\n}\n\nvar MIN_SIZE = 10;\nvar MAX_SIZE = 100;\nfunction isSvg(filename) {\n    return filename.search(/\\.svg(\\?|$)/i) !== -1;\n}\nfunction getOriginalSize(resource) {\n    if (isInstanceOfHTMLImageElement(resource)) {\n        var width = resource.naturalWidth;\n        var height = resource.naturalHeight;\n        // For SVG images with only viewBox attribute\n        if (!resource.naturalWidth && isSvg(resource.src)) {\n            width = height = MAX_SIZE;\n        }\n        return {\n            width: width,\n            height: height,\n        };\n    }\n    if (isInstanceOfHTMLVideoElement(resource)) {\n        return {\n            width: resource.videoWidth,\n            height: resource.videoHeight\n        };\n    }\n    if (isInstanceOfVideoFrame(resource)) {\n        return {\n            width: resource.codedWidth,\n            height: resource.codedHeight,\n        };\n    }\n    return {\n        width: resource.width,\n        height: resource.height\n    };\n}\nfunction getSrc(resource) {\n    if (isInstanceOfHTMLCanvasElement(resource)) {\n        return 'canvas';\n    }\n    if (isInstanceOfOffscreenCanvas(resource)) {\n        return 'offscreencanvas';\n    }\n    if (isInstanceOfVideoFrame(resource)) {\n        return 'videoframe';\n    }\n    if (isInstanceOfImageBitmap(resource)) {\n        return 'imagebitmap';\n    }\n    return resource.src;\n}\nfunction isInstanceOfHTMLImageElement(resource) {\n    return typeof HTMLImageElement !== 'undefined' && resource instanceof HTMLImageElement;\n}\nvar hasOffscreenCanvas = typeof OffscreenCanvas !== 'undefined';\nfunction isInstanceOfOffscreenCanvas(resource) {\n    return hasOffscreenCanvas && resource instanceof OffscreenCanvas;\n}\nfunction isInstanceOfHTMLVideoElement(resource) {\n    return typeof HTMLVideoElement !== 'undefined' && resource instanceof HTMLVideoElement;\n}\nfunction isInstanceOfVideoFrame(resource) {\n    return typeof VideoFrame !== 'undefined' && resource instanceof VideoFrame;\n}\nfunction isInstanceOfHTMLCanvasElement(resource) {\n    return typeof HTMLCanvasElement !== 'undefined' && resource instanceof HTMLCanvasElement;\n}\nfunction isInstanceOfImageBitmap(resource) {\n    return typeof ImageBitmap !== 'undefined' && resource instanceof ImageBitmap;\n}\nfunction prepareSizeAndPosition(originalSize, options) {\n    var srcLeft = getOption(options, 'left', 0);\n    var srcTop = getOption(options, 'top', 0);\n    var srcWidth = getOption(options, 'width', originalSize.width);\n    var srcHeight = getOption(options, 'height', originalSize.height);\n    var destWidth = srcWidth;\n    var destHeight = srcHeight;\n    if (options.mode === 'precision') {\n        return {\n            srcLeft: srcLeft,\n            srcTop: srcTop,\n            srcWidth: srcWidth,\n            srcHeight: srcHeight,\n            destWidth: destWidth,\n            destHeight: destHeight\n        };\n    }\n    var factor;\n    if (srcWidth > srcHeight) {\n        factor = srcWidth / srcHeight;\n        destWidth = MAX_SIZE;\n        destHeight = Math.round(destWidth / factor);\n    }\n    else {\n        factor = srcHeight / srcWidth;\n        destHeight = MAX_SIZE;\n        destWidth = Math.round(destHeight / factor);\n    }\n    if (destWidth > srcWidth || destHeight > srcHeight ||\n        destWidth < MIN_SIZE || destHeight < MIN_SIZE) {\n        destWidth = srcWidth;\n        destHeight = srcHeight;\n    }\n    return {\n        srcLeft: srcLeft,\n        srcTop: srcTop,\n        srcWidth: srcWidth,\n        srcHeight: srcHeight,\n        destWidth: destWidth,\n        destHeight: destHeight\n    };\n}\nvar isWebWorkers = typeof window === 'undefined';\nfunction makeCanvas() {\n    if (isWebWorkers) {\n        return hasOffscreenCanvas ? new OffscreenCanvas(1, 1) : null;\n    }\n    return document.createElement('canvas');\n}\n\nvar ERROR_PREFIX = 'FastAverageColor: ';\nfunction getError(message) {\n    return Error(ERROR_PREFIX + message);\n}\nfunction outputError(error, silent) {\n    if (!silent) {\n        console.error(error);\n    }\n}\n\nvar FastAverageColor = /** @class */ (function () {\n    function FastAverageColor() {\n        this.canvas = null;\n        this.ctx = null;\n    }\n    FastAverageColor.prototype.getColorAsync = function (resource, options) {\n        if (!resource) {\n            return Promise.reject(getError('call .getColorAsync() without resource'));\n        }\n        if (typeof resource === 'string') {\n            // Web workers\n            if (typeof Image === 'undefined') {\n                return Promise.reject(getError('resource as string is not supported in this environment'));\n            }\n            var img = new Image();\n            img.crossOrigin = options && options.crossOrigin || '';\n            img.src = resource;\n            return this.bindImageEvents(img, options);\n        }\n        else if (isInstanceOfHTMLImageElement(resource) && !resource.complete) {\n            return this.bindImageEvents(resource, options);\n        }\n        else {\n            var result = this.getColor(resource, options);\n            return result.error ? Promise.reject(result.error) : Promise.resolve(result);\n        }\n    };\n    /**\n     * Get the average color from images, videos and canvas.\n     */\n    FastAverageColor.prototype.getColor = function (resource, options) {\n        options = options || {};\n        var defaultColor = getDefaultColor(options);\n        if (!resource) {\n            var error = getError('call .getColor() without resource');\n            outputError(error, options.silent);\n            return this.prepareResult(defaultColor, error);\n        }\n        var originalSize = getOriginalSize(resource);\n        var size = prepareSizeAndPosition(originalSize, options);\n        if (!size.srcWidth || !size.srcHeight || !size.destWidth || !size.destHeight) {\n            var error = getError(\"incorrect sizes for resource \\\"\".concat(getSrc(resource), \"\\\"\"));\n            outputError(error, options.silent);\n            return this.prepareResult(defaultColor, error);\n        }\n        if (!this.canvas) {\n            this.canvas = makeCanvas();\n            if (!this.canvas) {\n                var error = getError('OffscreenCanvas is not supported in this browser');\n                outputError(error, options.silent);\n                return this.prepareResult(defaultColor, error);\n            }\n        }\n        if (!this.ctx) {\n            this.ctx = this.canvas.getContext('2d', { willReadFrequently: true });\n            if (!this.ctx) {\n                var error = getError('Canvas Context 2D is not supported in this browser');\n                outputError(error, options.silent);\n                return this.prepareResult(defaultColor);\n            }\n            this.ctx.imageSmoothingEnabled = false;\n        }\n        this.canvas.width = size.destWidth;\n        this.canvas.height = size.destHeight;\n        try {\n            this.ctx.clearRect(0, 0, size.destWidth, size.destHeight);\n            this.ctx.drawImage(resource, size.srcLeft, size.srcTop, size.srcWidth, size.srcHeight, 0, 0, size.destWidth, size.destHeight);\n            var bitmapData = this.ctx.getImageData(0, 0, size.destWidth, size.destHeight).data;\n            return this.prepareResult(this.getColorFromArray4(bitmapData, options));\n        }\n        catch (originalError) {\n            var error = getError(\"security error (CORS) for resource \".concat(getSrc(resource), \".\\nDetails: https://developer.mozilla.org/en/docs/Web/HTML/CORS_enabled_image\"));\n            outputError(error, options.silent);\n            if (!options.silent) {\n                console.error(originalError);\n            }\n            return this.prepareResult(defaultColor, error);\n        }\n    };\n    /**\n     * Get the average color from a array when 1 pixel is 4 bytes.\n     */\n    FastAverageColor.prototype.getColorFromArray4 = function (arr, options) {\n        options = options || {};\n        var bytesPerPixel = 4;\n        var arrLength = arr.length;\n        var defaultColor = getDefaultColor(options);\n        if (arrLength < bytesPerPixel) {\n            return defaultColor;\n        }\n        var len = arrLength - arrLength % bytesPerPixel;\n        var step = (options.step || 1) * bytesPerPixel;\n        var algorithm;\n        switch (options.algorithm || 'sqrt') {\n            case 'simple':\n                algorithm = simpleAlgorithm;\n                break;\n            case 'sqrt':\n                algorithm = sqrtAlgorithm;\n                break;\n            case 'dominant':\n                algorithm = dominantAlgorithm;\n                break;\n            default:\n                throw getError(\"\".concat(options.algorithm, \" is unknown algorithm\"));\n        }\n        return algorithm(arr, len, {\n            defaultColor: defaultColor,\n            ignoredColor: prepareIgnoredColor(options.ignoredColor),\n            step: step,\n            dominantDivider: options.dominantDivider,\n        });\n    };\n    /**\n     * Get color data from value ([r, g, b, a]).\n     */\n    FastAverageColor.prototype.prepareResult = function (value, error) {\n        var rgb = value.slice(0, 3);\n        var rgba = [value[0], value[1], value[2], value[3] / 255];\n        var isDarkColor = isDark(value);\n        return {\n            value: [value[0], value[1], value[2], value[3]],\n            rgb: 'rgb(' + rgb.join(',') + ')',\n            rgba: 'rgba(' + rgba.join(',') + ')',\n            hex: arrayToHex(rgb),\n            hexa: arrayToHex(value),\n            isDark: isDarkColor,\n            isLight: !isDarkColor,\n            error: error,\n        };\n    };\n    /**\n     * Destroy the instance.\n     */\n    FastAverageColor.prototype.destroy = function () {\n        if (this.canvas) {\n            this.canvas.width = 1;\n            this.canvas.height = 1;\n            this.canvas = null;\n        }\n        this.ctx = null;\n    };\n    FastAverageColor.prototype.bindImageEvents = function (resource, options) {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            var onload = function () {\n                unbindEvents();\n                var result = _this.getColor(resource, options);\n                if (result.error) {\n                    reject(result.error);\n                }\n                else {\n                    resolve(result);\n                }\n            };\n            var onerror = function () {\n                unbindEvents();\n                reject(getError(\"Error loading image \\\"\".concat(resource.src, \"\\\"\")));\n            };\n            var onabort = function () {\n                unbindEvents();\n                reject(getError(\"Image \\\"\".concat(resource.src, \"\\\" loading aborted\")));\n            };\n            var unbindEvents = function () {\n                resource.removeEventListener('load', onload);\n                resource.removeEventListener('error', onerror);\n                resource.removeEventListener('abort', onabort);\n            };\n            resource.addEventListener('load', onload);\n            resource.addEventListener('error', onerror);\n            resource.addEventListener('abort', onabort);\n        });\n    };\n    return FastAverageColor;\n}());\n\n\n\n\n//# sourceURL=webpack://asri/./node_modules/fast-average-color/dist/index.esm.js?")},"./src/main.ts":(__unused_webpack_module,exports,__webpack_require__)=>{eval('\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nconst modules_1 = __webpack_require__(/*! ./modules */ "./src/modules/index.ts");\n(0, modules_1.loadAsriJSModules)();\nwindow.destroyTheme = () => {\n    let completeUnload = true;\n    setTimeout(() => {\n        const themePairOnDestroy = {\n            "light": window.siyuan.config.appearance.themeLight,\n            "dark": window.siyuan.config.appearance.themeDark,\n        };\n        console.log("destroy", themePairOnDestroy);\n        if (themePairOnDestroy.light === "Asri" && themePairOnDestroy.dark === "Asri")\n            completeUnload = false;\n        console.log(`\\x1b[31m\\x1b[1m\\x1b[47mTheme destroy mode: ${completeUnload ? "complete" : "incomplete"}\\x1b[0m`);\n        (0, modules_1.unloadAsriJSModules)(completeUnload);\n    }, 0);\n};\n\n\n//# sourceURL=webpack://asri/./src/main.ts?')},"./src/modules/afwd.ts":function(__unused_webpack_module,exports,__webpack_require__){eval('\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.addAfwdMenuItems = addAfwdMenuItems;\nexports.removeProtyleSpacings = removeProtyleSpacings;\nconst api_1 = __webpack_require__(/*! ../util/api */ "./src/util/api.ts");\nconst misc_1 = __webpack_require__(/*! ../util/misc */ "./src/util/misc.ts");\nconst interfaceState_1 = __webpack_require__(/*! ../util/interfaceState */ "./src/util/interfaceState.ts");\nconst asriConfigs_1 = __webpack_require__(/*! ./asriConfigs */ "./src/modules/asriConfigs/index.ts");\nconst afwdBlockTypes = ["NodeParagraph", "NodeTable", "NodeAttributeView", "NodeSuperBlock", "NodeVideo", "NodeWidget", "NodeIFrame"];\nlet commonMenuEl;\nlet i18n = asriConfigs_1.i18n;\n/**\n * Deprecated due to siyuan\'s native support: https://github.com/siyuan-note/siyuan/pull/15043\n */\n// export function calcProtyleSpacings() {\n//   wndElements?.forEach((wnd) => {\n//     let protyles = wnd.querySelector(".file-tree") ? [] : (wnd.querySelectorAll(".protyle-wysiwyg") as unknown as HTMLElement[]);\n//     setTimeout(() => {\n//       protyles.forEach((protyle) => {\n//         let protylePadding: string;\n//         // let protylePadding = Math.round(parseFloat(window.getComputedStyle(protyle).paddingLeft)) + \'px\';\n//         protylePadding = protyle.style.paddingLeft;\n//         if (protylePadding !== protyle.dataset.prevpadding) {\n//           protyle.style.setProperty("--protyle-spacing", protylePadding);\n//           protyle.dataset.prevpadding = protylePadding;\n//           // console.log(protylePadding);\n//         }\n//       });\n//     }, 300); // protyle transition time\n//   });\n// }\nfunction addAfwdMenuItems(e) {\n    return __awaiter(this, void 0, void 0, function* () {\n        var _a, _b, _c;\n        if (e.type !== "mouseup")\n            return;\n        if (!i18n)\n            i18n = yield (0, asriConfigs_1.loadI18n)();\n        const target = e.target;\n        const targetLabel = target.closest(".ariaLabel");\n        if (!targetLabel)\n            return;\n        const gutterType = targetLabel.dataset.type; // block types, \'NodeSuperBlock\', \'NodeParagraph\'...\n        const nonGutterType = target.closest(".protyle-title__icon")\n            ? "doc"\n            : targetLabel.dataset.type === "doc" // \'doc\' | \'more\' | ... | undefined\n                ? "doc"\n                : undefined;\n        const type = afwdBlockTypes.includes(gutterType) ? gutterType : nonGutterType;\n        if (!type)\n            return;\n        const blockId = type === "doc" ? (_a = targetLabel.parentElement.dataset["nodeId"]) !== null && _a !== void 0 ? _a : (_c = (_b = targetLabel.closest(".protyle")) === null || _b === void 0 ? void 0 : _b.querySelector(".protyle-title")) === null || _c === void 0 ? void 0 : _c.dataset["nodeId"] : targetLabel.dataset["nodeId"];\n        commonMenuEl = yield (0, misc_1.querySelectorAsync)("#commonMenu:not(.fn__none)");\n        yield new Promise((resolve) => setTimeout(resolve, 0));\n        initializeCurBlocksAttrs(type, blockId);\n    });\n}\nfunction initializeCurBlocksAttrs(curBlockType, curBlockId) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const isDoc = curBlockType === "doc";\n        makeItems(curBlockType);\n        const attrs = yield (0, api_1.getBlockAttrs)(curBlockId);\n        let afwdAttrs = attrs["custom-afwd"];\n        let tdirAttr = attrs["custom-tdir"]; // \'ltr\' or \'rtl\'\n        if (!afwdAttrs)\n            afwdAttrs = "";\n        if (!tdirAttr)\n            tdirAttr = "";\n        afwdAttrs = afwdAttrs.split(" ");\n        // read & set initial states\n        if (afwdAttrs.length > 0) {\n            // for doc blocks\n            if (isDoc) {\n                afwdAttrs.forEach((attr) => {\n                    const menuItemEl = document.getElementById(`afwdMenuItem-${attr}`);\n                    if (menuItemEl) {\n                        menuItemEl.querySelector("input").checked = true;\n                    }\n                });\n                if (afwdAttrs.includes("all")) {\n                    const menuItemEls = commonMenuEl === null || commonMenuEl === void 0 ? void 0 : commonMenuEl.querySelectorAll("button[id^=afwdMenuItem]:not(#afwdMenuItem-all, #afwdMenuItem-clear)");\n                    menuItemEls === null || menuItemEls === void 0 ? void 0 : menuItemEls.forEach((el) => {\n                        el.classList.add("b3-menu__item--disabled");\n                        el.querySelector("input").disabled = true;\n                    });\n                }\n            }\n            // for indoc content blocks\n            else {\n                const menuItemEl = document.getElementById(`afwdMenuItem-${afwdAttrs[0]}`);\n                if (menuItemEl) {\n                    menuItemEl.classList.add("b3-menu__item--selected");\n                }\n            }\n        }\n        if (tdirAttr.length && isDoc) {\n            const menuItemEl = document.getElementById(`tdirMenuItem-${tdirAttr}`);\n            if (menuItemEl) {\n                menuItemEl.classList.add("b3-menu__item--selected");\n            }\n        }\n        menuItemsFunctionalities(isDoc, curBlockId, afwdAttrs, tdirAttr);\n    });\n}\nfunction makeItems(blockType) {\n    return __awaiter(this, void 0, void 0, function* () {\n        var _a, _b;\n        if (!commonMenuEl || document.getElementById("afwdMenuItem-clear"))\n            return;\n        const commonMenuBtnList = commonMenuEl.lastChild;\n        const afwdEntryBtn = document.createElement("button");\n        afwdEntryBtn.className = "b3-menu__item";\n        const separator = document.createElement("button");\n        separator.className = "b3-menu__separator";\n        const inDocBlockMenuItems = `\n        <button class="b3-menu__item b3-menu__item--custom" id="afwdMenuItem-on">\n            <svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">\n            <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="m9 12l2 2l4-4"/></g>\n            </svg>\n            <span class="b3-menu__label">${i18n["afwdMenuItem-on"]}</span>\n        </button>\n        <button class="b3-menu__item b3-menu__item--custom" id="afwdMenuItem-off">\n            <svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">\n            <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="m15 9l-6 6m0-6l6 6"/></g>\n            </svg>\n            <span class="b3-menu__label">${i18n["afwdMenuItem-off"]}</span>\n        </button>\n    `;\n        const docMenuItems = `\n        <button class="b3-menu__item b3-menu__item--custom" id="afwdMenuItem-all">\n            <span class="b3-menu__label">\n                <div class="fn__flex">\n                    <svg class="b3-menu__icon" style=""></svg>\n                    <span>${i18n["afwdMenuItem-all"]}</span>\n                    <span class="fn__space fn__flex-1"></span>\n                    <input type="checkbox" class="b3-switch fn__flex-center">\n                </div>\n            </span>\n        </button>\n        <button class="b3-menu__item b3-menu__item--custom" id="afwdMenuItem-db">\n            <span class="b3-menu__label">\n                <div class="fn__flex">\n                    <svg class="b3-menu__icon" style=""><use xlink:href="#iconDatabase"></use></svg>\n                    <span>${i18n["afwdMenuItem-db"]}</span>\n                    <span class="fn__space fn__flex-1"></span>\n                    <input type="checkbox" class="b3-switch fn__flex-center">\n                </div>\n            </span>\n        </button>\n        <button class="b3-menu__item b3-menu__item--custom" id="afwdMenuItem-t">\n            <span class="b3-menu__label">\n                <div class="fn__flex">\n                    <svg class="b3-menu__icon" style=""><use xlink:href="#iconTable"></use></svg>\n                    <span>${i18n["afwdMenuItem-t"]}</span>\n                    <span class="fn__space fn__flex-1"></span>\n                    <input type="checkbox" class="b3-switch fn__flex-center">\n                </div>\n            </span>\n        </button>\n        <button class="b3-menu__item b3-menu__item--custom" id="afwdMenuItem-p">\n            <span class="b3-menu__label">\n                <div class="fn__flex">\n                    <svg class="b3-menu__icon"><use xlink:href="#iconImage"></use></svg>\n                    <span>${i18n["afwdMenuItem-p"]}</span>\n                    <span class="fn__space fn__flex-1"></span>\n                    <input type="checkbox" class="b3-switch fn__flex-center">\n                </div>\n            </span>\n        </button>\n        <button class="b3-menu__item b3-menu__item--custom" id="afwdMenuItem-iframe">\n            <span class="b3-menu__label">\n                <div class="fn__flex">\n                    <svg class="b3-menu__icon"><use xlink:href="#iconHTML5"></use></svg>\n                    <span>${i18n["afwdMenuItem-iframe"]}</span>\n                    <span class="fn__space fn__flex-1"></span>\n                    <input type="checkbox" class="b3-switch fn__flex-center">\n                </div>\n            </span>\n        </button>\n        <button class="b3-menu__item b3-menu__item--custom" id="afwdMenuItem-sb">\n            <span class="b3-menu__label">\n                <div class="fn__flex">\n                    <svg class="b3-menu__icon"><use xlink:href="#iconSuper"></use></svg>\n                    <span>${i18n["afwdMenuItem-sb"]}</span>\n                    <span class="fn__space fn__flex-1"></span>\n                    <input type="checkbox" class="b3-switch fn__flex-center">\n                </div>\n            </span>\n        </button>\n    `;\n        const afwdMenuBtnHtml = `\n        <svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 18 18">\n            <path fill="currentColor" d="m15.503 15.003l-.735.71a.75.75 0 1 0 1.042 1.078l1.886-1.82a1 1 0 0 0 0-1.44l-1.886-1.82a.75.75 0 0 0-1.042 1.079l.739.713H12.75a.75.75 0 0 0 0 1.5zM15 3a2 2 0 0 1 2 2v4.25a.75.75 0 0 1-1.5 0V5a.5.5 0 0 0-.5-.5H5a.5.5 0 0 0-.5.5v4.25a.75.75 0 0 1-1.5 0V5a2 2 0 0 1 2-2zM5.234 15.712l-.735-.71h2.752a.75.75 0 1 0 0-1.5H4.495l.739-.713a.75.75 0 0 0-1.042-1.078l-1.886 1.82a1 1 0 0 0 0 1.44l1.886 1.82a.75.75 0 0 0 1.042-1.079"/>\n        </svg>\n        <span class="b3-menu__label">${i18n["afwdDocMenuLabel"]}</span>\n        <svg class="b3-menu__icon b3-menu__icon--small">\n            <use xlink:href="#iconRight"></use>\n        </svg>\n        <div class="b3-menu__submenu">\n            <div class="b3-menu__items">\n                ${blockType === "doc" ? docMenuItems : inDocBlockMenuItems}\n                <button class="b3-menu__separator"></button>\n                <button class="b3-menu__item" id="afwdMenuItem-clear">\n                    <svg class="b3-menu__icon " style=""><use xlink:href="#iconTrashcan"></use></svg>\n                    <span class="b3-menu__label">${i18n["afwdMenuItem-clear"]}\n                    </span>\n                </button>\n            </div>\n        </div>\n    `;\n        afwdEntryBtn.innerHTML = afwdMenuBtnHtml;\n        commonMenuBtnList.insertBefore(afwdEntryBtn, (_a = commonMenuBtnList.lastChild) === null || _a === void 0 ? void 0 : _a.previousSibling);\n        commonMenuBtnList.insertBefore(separator, afwdEntryBtn);\n        // tdir menu\n        if (blockType !== "doc")\n            return;\n        const tdirEntryBtn = document.createElement("button");\n        tdirEntryBtn.className = "b3-menu__item";\n        const tdirMenuBtnHtml = `\n        <svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 22 22">\n            <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 5h-3m-5 0h5m-5 0v10m0-10h-1c-1.667 0-5 1-5 5s3.333 5 5 5h1m0 4v-4m5 4V5"/>\n        </svg>\n        <span class="b3-menu__label">${i18n["tdirDocMenuLabel"]}</span>\n        <svg class="b3-menu__icon b3-menu__icon--small">\n            <use xlink:href="#iconRight"></use>\n        </svg>\n        <div class="b3-menu__submenu">\n            <div class="b3-menu__items">\n                <button class="b3-menu__item b3-menu__item--custom" id="tdirMenuItem-ltr">\n                    <svg class="b3-menu__icon " style=""><use xlink:href="#iconLtr"></use></svg>\n                    <span class="b3-menu__label">${i18n["tdirMenuItem-ltr"]}</span>\n                </button>\n                <button class="b3-menu__item b3-menu__item--custom" id="tdirMenuItem-rtl">\n                    <svg class="b3-menu__icon " style=""><use xlink:href="#iconRtl"></use></svg>\n                    <span class="b3-menu__label">${i18n["tdirMenuItem-rtl"]}</span>\n                </button>                \n                <button class="b3-menu__separator"></button>\n                <button class="b3-menu__item" id="tdirMenuItem-clear">\n                    <svg class="b3-menu__icon " style=""><use xlink:href="#iconTrashcan"></use></svg>\n                    <span class="b3-menu__label">${i18n["afwdMenuItem-clear"]}\n                    </span>\n                </button>\n            </div>\n        </div>\n    `;\n        tdirEntryBtn.innerHTML = tdirMenuBtnHtml;\n        commonMenuBtnList.insertBefore(tdirEntryBtn, (_b = commonMenuBtnList.lastChild) === null || _b === void 0 ? void 0 : _b.previousSibling);\n    });\n}\nfunction menuItemsFunctionalities(isDoc, curBlockId, afwdAttrs, tdirAttrs) {\n    const afwdMenuItemEls = commonMenuEl === null || commonMenuEl === void 0 ? void 0 : commonMenuEl.querySelectorAll("button[id^=afwdMenuItem]:not(#afwdMenuItem-clear)");\n    const tdirMenuItemEls = commonMenuEl === null || commonMenuEl === void 0 ? void 0 : commonMenuEl.querySelectorAll("button[id^=tdirMenuItem]:not(#tdirMenuItem-clear)");\n    let groupedAttrsReserved = []; // save all attrs except \'all\', \'on\', \'off\'\n    const afwdMenuItemElsExceptAll = [...afwdMenuItemEls].filter((el) => el.id !== "afwdMenuItem-all");\n    if (isDoc) {\n        // set doc blocks afwd menu funcs\n        afwdMenuItemEls === null || afwdMenuItemEls === void 0 ? void 0 : afwdMenuItemEls.forEach((el) => {\n            el.onclick = (ev) => {\n                if (el.classList.contains("b3-menu__item--disabled"))\n                    return;\n                const input = el.querySelector("input");\n                const curAttrItem = el["id"].split("-")[1]; // \'all\' | \'db\' | ...\n                let isOn = input.checked; // check initial state\n                // clicking on input itself will toggle the checkbox automatically,\n                // but when clicking on label, we need to toggle it manually\n                if (ev.target === input)\n                    isOn = !isOn; // when clicking on input, restore to the state where the checkbox was not clicked\n                else\n                    input.checked = !isOn; // this is only used to change the state of the checkbox\'s appearance when clicking on label\n                // when menu item is actived\n                if (isOn) {\n                    if (curAttrItem === "all") {\n                        afwdMenuItemElsExceptAll.forEach((el) => {\n                            el.classList.remove("b3-menu__item--disabled");\n                            el.querySelector("input").disabled = false;\n                        });\n                        afwdAttrs = groupedAttrsReserved.length > 0 ? groupedAttrsReserved : [];\n                    }\n                    else\n                        afwdAttrs = afwdAttrs.filter((a) => a !== curAttrItem);\n                }\n                // when menu item is deactived\n                else {\n                    if (curAttrItem === "all") {\n                        if (!afwdAttrs.includes("all"))\n                            groupedAttrsReserved = afwdAttrs;\n                        afwdAttrs = ["all"];\n                        afwdMenuItemElsExceptAll.forEach((el) => {\n                            el.classList.add("b3-menu__item--disabled");\n                            el.querySelector("input").disabled = true;\n                        });\n                    }\n                    else\n                        afwdAttrs.push(curAttrItem);\n                }\n                (0, api_1.setBlockAttrs)(curBlockId, { "custom-afwd": afwdAttrs.join(" ") || "" });\n            };\n        });\n        // set doc blocks tdir menu funcs\n        tdirMenuItemEls === null || tdirMenuItemEls === void 0 ? void 0 : tdirMenuItemEls.forEach((el, index, arr) => {\n            el.onclick = () => {\n                const attr = el["id"].split("-")[1]; // \'ltr\' or \'rtl\'\n                const isSelected = el.classList.contains("b3-menu__item--selected");\n                if (isSelected) {\n                    el.classList.remove("b3-menu__item--selected");\n                    tdirAttrs = [];\n                }\n                else {\n                    tdirAttrs = [attr];\n                    el.classList.add("b3-menu__item--selected");\n                    arr[1 - index].classList.remove("b3-menu__item--selected");\n                }\n                (0, api_1.setBlockAttrs)(curBlockId, { "custom-tdir": `${tdirAttrs.join("")}` });\n            };\n        });\n    }\n    // set indoc blocks afwd menu funcs\n    else {\n        afwdMenuItemEls === null || afwdMenuItemEls === void 0 ? void 0 : afwdMenuItemEls.forEach((el, index, arr) => {\n            el.onclick = () => {\n                const attr = el["id"].split("-")[1]; // \'on\' | \'off\'\n                const isSelected = el.classList.contains("b3-menu__item--selected");\n                if (isSelected) {\n                    afwdAttrs = [];\n                    el.classList.remove("b3-menu__item--selected");\n                }\n                else {\n                    afwdAttrs = [attr];\n                    el.classList.add("b3-menu__item--selected");\n                    arr[1 - index].classList.remove("b3-menu__item--selected");\n                }\n                (0, api_1.setBlockAttrs)(curBlockId, { "custom-afwd": (afwdAttrs === null || afwdAttrs === void 0 ? void 0 : afwdAttrs.join(" ")) || "" });\n            };\n        });\n    }\n    // functionality of afwd clear button\n    const afwdClearBtn = document.getElementById("afwdMenuItem-clear");\n    if (!afwdClearBtn)\n        return;\n    afwdClearBtn.onclick = () => {\n        afwdAttrs = [];\n        groupedAttrsReserved = [];\n        (0, api_1.setBlockAttrs)(curBlockId, { "custom-afwd": "" });\n        afwdMenuItemEls.forEach((el) => {\n            el.classList.remove("b3-menu__item--disabled");\n            el.classList.remove("b3-menu__item--selected");\n            if (isDoc) {\n                const inputEl = el.querySelector("input");\n                inputEl.disabled = false;\n                inputEl.checked = false;\n            }\n        });\n    };\n    // functionality of tdir clear button\n    if (!isDoc)\n        return;\n    const tdirClearBtn = document.getElementById("tdirMenuItem-clear");\n    if (!tdirClearBtn)\n        return;\n    tdirClearBtn.onclick = () => {\n        tdirAttrs = [];\n        (0, api_1.setBlockAttrs)(curBlockId, { "custom-tdir": "" });\n        tdirMenuItemEls.forEach((el) => {\n            el.classList.remove("b3-menu__item--selected");\n        });\n    };\n}\nfunction removeProtyleSpacings() {\n    interfaceState_1.wndElements === null || interfaceState_1.wndElements === void 0 ? void 0 : interfaceState_1.wndElements.forEach((wnd) => {\n        let protyles = wnd.querySelector(".file-tree") ? [] : wnd.querySelectorAll(".protyle-wysiwyg");\n        protyles.forEach((protyle) => {\n            protyle.style.removeProperty("--protyle-spacing");\n            protyle.dataset.prevpadding = undefined;\n        });\n    });\n}\n\n\n//# sourceURL=webpack://asri/./src/modules/afwd.ts?')},"./src/modules/asriConfigs/configs.ts":function(__unused_webpack_module,exports,__webpack_require__){eval('\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.asriConfigs = void 0;\nexports.getLocalConfigs = getLocalConfigs;\nexports.updateAsriConfigs = updateAsriConfigs;\nconst api_1 = __webpack_require__(/*! ../../util/api */ "./src/util/api.ts");\nconst rsc_1 = __webpack_require__(/*! ../../util/rsc */ "./src/util/rsc.ts");\nconst state_1 = __webpack_require__(/*! ./state */ "./src/modules/asriConfigs/state.ts");\nexports.asriConfigs = {\n    "light": {\n        "followSysAccentColor": false,\n        "followCoverImgColor": false,\n        "chroma": "1",\n        "userCustomColor": "#3478f6",\n        "presetPalette": "",\n    },\n    "dark": {\n        "followSysAccentColor": false,\n        "followCoverImgColor": false,\n        "chroma": "1",\n        "userCustomColor": "#3478f6",\n        "presetPalette": "",\n    },\n    "features": {\n        "tfp": "",\n    },\n};\nfunction getLocalConfigs() {\n    return __awaiter(this, void 0, void 0, function* () {\n        console.log("curMode", rsc_1.environment.appSchemeMode);\n        yield (0, api_1.getFile)("/data/snippets/Asri.config.json")\n            .then((response) => {\n            if (response && response.status === 200) {\n                return response.json();\n            }\n            return null;\n        })\n            .then((data) => {\n            var _a, _b, _c;\n            if (!data) {\n                return;\n            }\n            // 如果本地配置缺失数据，则赋与默认值\n            for (let key in exports.asriConfigs) {\n                if (!(key in data)) {\n                    data[key] = exports.asriConfigs[key];\n                }\n            }\n            const modes = ["light", "dark"];\n            for (const mode of modes) {\n                exports.asriConfigs[mode].followSysAccentColor = !!data[mode].followSysAccentColor;\n                exports.asriConfigs[mode].followCoverImgColor = !!data[mode].followCoverImgColor;\n                exports.asriConfigs[mode].chroma = (_a = data[mode].chroma) !== null && _a !== void 0 ? _a : "1";\n                exports.asriConfigs[mode].userCustomColor = (_b = data[mode].userCustomColor) !== null && _b !== void 0 ? _b : "#3478f6";\n                exports.asriConfigs[mode].presetPalette = (_c = data[mode].presetPalette) !== null && _c !== void 0 ? _c : "";\n            }\n            exports.asriConfigs.features = data.features;\n            (0, state_1.setFollowSysAccentColor)(!!data[rsc_1.environment.appSchemeMode].followSysAccentColor);\n        });\n    });\n}\nfunction updateAsriConfigs() {\n    return __awaiter(this, void 0, void 0, function* () {\n        yield (0, api_1.putFile)("/data/snippets/Asri.config.json", JSON.stringify(exports.asriConfigs, undefined, 4));\n    });\n}\n\n\n//# sourceURL=webpack://asri/./src/modules/asriConfigs/configs.ts?')},"./src/modules/asriConfigs/core.ts":function(__unused_webpack_module,exports,__webpack_require__){eval('\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.loadThemePalette = loadThemePalette;\nexports.unloadThemePalette = unloadThemePalette;\nexports.initI18n = initI18n;\nconst rsc_1 = __webpack_require__(/*! ../../util/rsc */ "./src/util/rsc.ts");\nconst i18n_1 = __webpack_require__(/*! ./i18n */ "./src/modules/asriConfigs/i18n.ts");\nconst configs_1 = __webpack_require__(/*! ./configs */ "./src/modules/asriConfigs/configs.ts");\nconst palettes_1 = __webpack_require__(/*! ./palettes */ "./src/modules/asriConfigs/palettes.ts");\nconst state_1 = __webpack_require__(/*! ./state */ "./src/modules/asriConfigs/state.ts");\nconst cssVarManager_1 = __webpack_require__(/*! ./cssVarManager */ "./src/modules/asriConfigs/cssVarManager.ts");\nconst systemColor_1 = __webpack_require__(/*! ./systemColor */ "./src/modules/asriConfigs/systemColor.ts");\nconst util_1 = __webpack_require__(/*! ./util */ "./src/modules/asriConfigs/util.ts");\nconst coverImgColor_1 = __webpack_require__(/*! ./coverImgColor */ "./src/modules/asriConfigs/coverImgColor.ts");\nfunction loadThemePalette() {\n    return __awaiter(this, void 0, void 0, function* () {\n        // if (env.isIOSApp) return; // fix app crash\n        // const i18n = await loadI18n();\n        (0, state_1.setCurMode)(rsc_1.environment.appSchemeMode);\n        yield (0, configs_1.getLocalConfigs)();\n        if (!rsc_1.environment.supportOklch)\n            return;\n        // check local configs to set initial theme color\n        const shouldUseCustomColor = rsc_1.environment.isInBrowser ||\n            rsc_1.environment.isMobile ||\n            rsc_1.environment.isLinux ||\n            (!state_1.followSysAccentColor && !configs_1.asriConfigs[state_1.curMode].followCoverImgColor);\n        if (shouldUseCustomColor) {\n            cssVarManager_1.cssVarManager.setProperty("--asri-user-custom-accent", configs_1.asriConfigs[state_1.curMode].userCustomColor);\n            cssVarManager_1.cssVarManager.removeProperty("--asri-cover-dominant");\n            (0, util_1.reverseOnPrimaryLightness)(configs_1.asriConfigs[state_1.curMode].userCustomColor);\n        }\n        else {\n            cssVarManager_1.cssVarManager.removeProperty("--asri-user-custom-accent");\n            if (configs_1.asriConfigs[state_1.curMode].followCoverImgColor)\n                cssVarManager_1.cssVarManager.removeProperty("--asri-cover-dominant");\n        }\n        if (configs_1.asriConfigs[state_1.curMode].presetPalette) {\n            const paletteID = configs_1.asriConfigs[state_1.curMode].presetPalette;\n            const curPalette = palettes_1.asriPrstPalettes[paletteID][state_1.curMode];\n            document.documentElement.setAttribute("data-asri-palette", paletteID.split("-")[2]);\n            (0, state_1.setFollowSysAccentColor)(false);\n            cssVarManager_1.cssVarManager.setProperty("--asri-user-custom-accent", curPalette.primary);\n            cssVarManager_1.cssVarManager.setProperty("--asri-c-factor", curPalette.chroma);\n            cssVarManager_1.cssVarManager.removeProperty("--asri-cover-dominant");\n            (0, state_1.setIsUserAccentGray)(curPalette.chroma === "0" ? true : false);\n            (0, util_1.handleGrayScale)(curPalette.chroma);\n            (0, util_1.reverseOnPrimaryLightness)(curPalette.primary);\n        }\n        else if (configs_1.asriConfigs[state_1.curMode].followCoverImgColor) {\n            cssVarManager_1.cssVarManager.setProperty("--asri-c-factor", configs_1.asriConfigs[state_1.curMode].chroma);\n            document.documentElement.removeAttribute("data-asri-palette");\n            (0, coverImgColor_1.updateCoverImgColor)();\n        }\n        else {\n            cssVarManager_1.cssVarManager.setProperty("--asri-c-factor", configs_1.asriConfigs[state_1.curMode].chroma);\n            document.documentElement.removeAttribute("data-asri-palette");\n            (0, state_1.setIsUserAccentGray)(configs_1.asriConfigs[state_1.curMode].chroma === "0" ? true : false);\n            (0, util_1.handleGrayScale)(configs_1.asriConfigs[state_1.curMode].chroma);\n        }\n        (0, systemColor_1.getSystemAccentColor)();\n        if (configs_1.asriConfigs.features.tfp) {\n            document.body.classList.add("asri-tfp", "asri-tfp-" + configs_1.asriConfigs.features.tfp);\n        }\n        // env.supportOklch && asriDoms.barMode?.addEventListener("click", customizeThemeColor);\n    });\n}\nfunction unloadThemePalette() {\n    // cssVarManager.removeProperty("--asri-user-custom-accent");\n    // cssVarManager.removeProperty("--asri-sys-accent-grayscale");\n    // cssVarManager.removeProperty("--asri-c-factor");\n    // cssVarManager.removeProperty("--asri-sys-accent");\n    // cssVarManager.removeProperty("--asri-sys-accent-accessible");\n    // cssVarManager.removeProperty("--asri-c-0");\n    // cssVarManager.removeProperty("--asri-on-primary-reverse");\n    // cssVarManager.removeProperty("--asri-cover-dominant");\n    cssVarManager_1.cssVarManager.destory();\n    coverImgColor_1.coverImgColorManager.destory();\n    // asriDoms.barMode?.removeEventListener("click", customizeThemeColor);\n    document.body.classList.remove("asri-c-0");\n    document.querySelectorAll(".asri-config").forEach((el) => el.remove());\n}\nfunction initI18n() {\n    return __awaiter(this, void 0, void 0, function* () {\n        const i18n = yield (0, i18n_1.loadI18n)();\n        (0, state_1.setI18n)(i18n);\n        return i18n;\n    });\n}\n\n\n//# sourceURL=webpack://asri/./src/modules/asriConfigs/core.ts?')},"./src/modules/asriConfigs/coverImgColor.ts":function(__unused_webpack_module,exports,__webpack_require__){eval('\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.coverImgColorManager = void 0;\nexports.getCoverImgColor = getCoverImgColor;\nexports.updateCoverImgColor = updateCoverImgColor;\nconst fast_average_color_1 = __webpack_require__(/*! fast-average-color */ "./node_modules/fast-average-color/dist/index.esm.js");\nconst colorTools_1 = __webpack_require__(/*! ../../util/colorTools */ "./src/util/colorTools.ts");\nconst misc_1 = __webpack_require__(/*! ../../util/misc */ "./src/util/misc.ts");\nconst configs_1 = __webpack_require__(/*! ./configs */ "./src/modules/asriConfigs/configs.ts");\nconst cssVarManager_1 = __webpack_require__(/*! ./cssVarManager */ "./src/modules/asriConfigs/cssVarManager.ts");\nconst state_1 = __webpack_require__(/*! ./state */ "./src/modules/asriConfigs/state.ts");\nconst util_1 = __webpack_require__(/*! ./util */ "./src/modules/asriConfigs/util.ts");\nconst fac = new fast_average_color_1.FastAverageColor();\nclass CoverImgColorManager {\n    constructor() { }\n    static getInstance() {\n        if (!CoverImgColorManager.instance) {\n            CoverImgColorManager.instance = new CoverImgColorManager();\n        }\n        return CoverImgColorManager.instance;\n    }\n    /**\n     * @param activeDocId - The ID of the active document\n     * @returns a subject of the type of the source image (img/vid/css) and the source image element/hex color, or null if no source image is found\n     */\n    getSourceType(activeDocId) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const curProtyle = (yield (0, misc_1.getFocusedProtyleInfo)(activeDocId, true)).protyle;\n            let res = null;\n            if (!curProtyle)\n                return res;\n            const backgroundParentElement = curProtyle.querySelector(`.protyle-background__img:not(.fn__none)`);\n            if (!backgroundParentElement)\n                return res;\n            const backgroundImgElement = backgroundParentElement.querySelector(`&>img`);\n            const backgroundVidElement = backgroundParentElement.querySelector(`&>video`);\n            if (backgroundImgElement.style) {\n                const style = backgroundImgElement.style;\n                if (style.backgroundColor) {\n                    return (res = {\n                        type: "css",\n                        source: (0, colorTools_1.convertToHex)(style.backgroundColor),\n                    });\n                }\n                if (style.backgroundImage) {\n                    const cssText = style.backgroundImage;\n                    let parsedColor = (0, colorTools_1.extractFirstColorFromCSSBackground)(cssText);\n                    return (res = {\n                        type: "css",\n                        source: parsedColor || "#3478f6",\n                    });\n                }\n            }\n            if (backgroundVidElement) {\n                return (res = {\n                    type: "vid",\n                    source: backgroundVidElement,\n                });\n            }\n            if (backgroundImgElement) {\n                return (res = {\n                    type: "img",\n                    source: backgroundImgElement,\n                });\n            }\n            return res;\n        });\n    }\n    getSourceImg(activeDocId) {\n        const sourceImg = document.querySelector(`.protyle:not(.fn__none)[data-id="${activeDocId}] .protyle-background__img:not(.fn__none)> img`);\n        return sourceImg || null;\n    }\n    getSourceVid(activeDocId) {\n        const sourceVid = document.querySelector(`.protyle:not(.fn__none)[data-id="${activeDocId}] .protyle-background__img:not(.fn__none)> video`);\n        return sourceVid || null;\n    }\n    getCoverImgColorAsync(sourceImg_1) {\n        return __awaiter(this, arguments, void 0, function* (sourceImg, option = { algorithm: "dominant" }) {\n            if (!sourceImg)\n                return;\n            const color = yield fac.getColorAsync(sourceImg, option);\n            return color.hex;\n        });\n    }\n    getCoverVidColor(sourceVid, option = { algorithm: "dominant" }) {\n        if (!sourceVid)\n            return;\n        const color = fac.getColor(sourceVid, option);\n        return color.hex;\n    }\n    destory() {\n        fac.destroy();\n        CoverImgColorManager.instance = null;\n    }\n}\nCoverImgColorManager.instance = null;\nexports.coverImgColorManager = CoverImgColorManager.getInstance();\nfunction getCoverImgColor(activeDocId) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const sourceType = yield exports.coverImgColorManager.getSourceType(activeDocId);\n        if (!sourceType)\n            return;\n        if (sourceType.type === "css") {\n            return sourceType.source;\n        }\n        if (sourceType.type === "vid") {\n            return exports.coverImgColorManager.getCoverVidColor(sourceType.source);\n        }\n        if (sourceType.type === "img") {\n            return (yield exports.coverImgColorManager.getCoverImgColorAsync(sourceType.source));\n        }\n    });\n}\nfunction updateCoverImgColor(activeDocId) {\n    return __awaiter(this, void 0, void 0, function* () {\n        var _a, _b;\n        const color = yield getCoverImgColor(activeDocId);\n        const prevColor = cssVarManager_1.cssVarManager.getAllVars().get("--asri-cover-dominant");\n        let targetColor;\n        let colorChroma;\n        if (!color) {\n            if (!prevColor) {\n                targetColor = configs_1.asriConfigs[state_1.curMode].userCustomColor;\n                colorChroma = parseFloat(configs_1.asriConfigs[state_1.curMode].chroma) || 0;\n            }\n            else {\n                targetColor = prevColor;\n                colorChroma = ((_a = (0, colorTools_1.hexToOklch)(prevColor)) === null || _a === void 0 ? void 0 : _a.C) || 0;\n            }\n        }\n        else {\n            targetColor = color;\n            colorChroma = ((_b = (0, colorTools_1.hexToOklch)(color)) === null || _b === void 0 ? void 0 : _b.C) || 0;\n        }\n        cssVarManager_1.cssVarManager.setProperty("--asri-cover-dominant", targetColor);\n        const isGray = colorChroma.toFixed(3) === "0.000";\n        (0, state_1.setIsCoverImgColorGray)(isGray);\n        if (isGray || configs_1.asriConfigs[state_1.curMode].chroma === "0") {\n            colorChroma = 0;\n        }\n        console.log("isCoverImgColorGray", targetColor, colorChroma, state_1.isCoverImgColorGray);\n        (0, util_1.handleGrayScale)(colorChroma);\n        (0, util_1.reverseOnPrimaryLightness)(targetColor);\n    });\n}\n\n\n//# sourceURL=webpack://asri/./src/modules/asriConfigs/coverImgColor.ts?')},"./src/modules/asriConfigs/cssVarManager.ts":(__unused_webpack_module,exports)=>{eval('\n/**\n * @description 管理配色相关CSS变量,在head元素上设置CSS变量,使这些变量能应用到导出界面\n * @author mustakshif\n * @date 2025-06\n */\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.cssVarManager = exports.CSSVarManager = void 0;\nclass CSSVarManager {\n    constructor() {\n        this.rafId = null;\n        // 检查是否已存在style元素\n        const existingStyle = document.getElementById("snippetCSS-asri-root-vars");\n        if (existingStyle) {\n            this.styleElement = existingStyle;\n            // 解析现有的CSS变量\n            this.existingVars = this.parseExistingVars();\n        }\n        else {\n            this.styleElement = document.createElement("style");\n            this.styleElement.id = "snippetCSS-asri-root-vars";\n            document.head.appendChild(this.styleElement);\n            this.existingVars = new Map();\n        }\n        this.pendingUpdates = new Map();\n    }\n    parseExistingVars() {\n        const vars = new Map();\n        const cssText = this.styleElement.textContent;\n        if (!cssText)\n            return vars;\n        // 解析:root中的CSS变量\n        const rootMatch = cssText.match(/:root\\s*{([^}]*)}/);\n        if (rootMatch) {\n            const varDeclarations = rootMatch[1].split(";");\n            for (const declaration of varDeclarations) {\n                const [name, value] = declaration.split(":").map((s) => s.trim());\n                if (name && value) {\n                    vars.set(name, value);\n                }\n            }\n        }\n        return vars;\n    }\n    static getInstance() {\n        if (!CSSVarManager.instance) {\n            CSSVarManager.instance = new CSSVarManager();\n        }\n        return CSSVarManager.instance;\n    }\n    setProperty(name, value) {\n        this.pendingUpdates.set(name, value);\n        this.scheduleUpdate();\n    }\n    removeProperty(name) {\n        this.pendingUpdates.set(name, "");\n        this.scheduleUpdate();\n    }\n    scheduleUpdate() {\n        if (this.rafId !== null) {\n            cancelAnimationFrame(this.rafId);\n        }\n        this.rafId = requestAnimationFrame(() => this.applyUpdates());\n    }\n    applyUpdates() {\n        if (this.pendingUpdates.size === 0)\n            return;\n        let cssText = ":root {";\n        // 合并现有变量和待更新变量\n        const allVars = new Map([...this.existingVars, ...this.pendingUpdates]);\n        allVars.forEach((value, name) => {\n            if (value === "") {\n                this.existingVars.delete(name);\n            }\n            else {\n                cssText += `${name}: ${value};`;\n                this.existingVars.set(name, value);\n            }\n        });\n        cssText += "}";\n        this.styleElement.textContent = cssText;\n        this.pendingUpdates.clear();\n        this.rafId = null;\n    }\n    // 获取当前所有CSS变量的值\n    getAllVars() {\n        return new Map(this.existingVars);\n    }\n    destory() {\n        this.styleElement.remove();\n        CSSVarManager.instance = null;\n    }\n}\nexports.CSSVarManager = CSSVarManager;\nCSSVarManager.instance = null;\nexports.cssVarManager = CSSVarManager.getInstance();\n\n\n//# sourceURL=webpack://asri/./src/modules/asriConfigs/cssVarManager.ts?')},"./src/modules/asriConfigs/eventHandlers.ts":function(__unused_webpack_module,exports,__webpack_require__){eval('\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.initAsriConfigMenuItemClick = initAsriConfigMenuItemClick;\nexports.setupTfpMenuItemCallback = setupTfpMenuItemCallback;\nexports.removeTfpMenuItemCallback = removeTfpMenuItemCallback;\nexports.setupPaletteMenuItemClick = setupPaletteMenuItemClick;\nexports.removePaletteMenuItemClick = removePaletteMenuItemClick;\nconst misc_1 = __webpack_require__(/*! ../../util/misc */ "./src/util/misc.ts");\nconst rsc_1 = __webpack_require__(/*! ../../util/rsc */ "./src/util/rsc.ts");\nconst modeTransition_1 = __webpack_require__(/*! ../modeTransition */ "./src/modules/modeTransition.ts");\nconst cssVarManager_1 = __webpack_require__(/*! ./cssVarManager */ "./src/modules/asriConfigs/cssVarManager.ts");\nconst configs_1 = __webpack_require__(/*! ./configs */ "./src/modules/asriConfigs/configs.ts");\nconst palettes_1 = __webpack_require__(/*! ./palettes */ "./src/modules/asriConfigs/palettes.ts");\nconst state_1 = __webpack_require__(/*! ./state */ "./src/modules/asriConfigs/state.ts");\nconst systemColor_1 = __webpack_require__(/*! ./systemColor */ "./src/modules/asriConfigs/systemColor.ts");\nconst util_1 = __webpack_require__(/*! ./util */ "./src/modules/asriConfigs/util.ts");\nconst coverImgColor_1 = __webpack_require__(/*! ./coverImgColor */ "./src/modules/asriConfigs/coverImgColor.ts");\nfunction initAsriConfigMenuItemClick() {\n    if (!state_1.followSysAccentBtn || !state_1.pickColorBtn || !state_1.asriChromaSlider || !state_1.colorPicker || !state_1.followCoverImgColorBtn)\n        return;\n    // handle click events\n    if (rsc_1.environment.isInBrowser || rsc_1.environment.isMobile || rsc_1.environment.isLinux) {\n        // followSysAccentColor = false;\n        state_1.followSysAccentBtn.classList.add("fn__none");\n    }\n    else {\n        state_1.followSysAccentBtn.addEventListener("click", handleFollowSystemAccentBtnClick);\n    }\n    state_1.pickColorBtn.addEventListener("mouseup", handlePickColorBtnClick); // 使用mouseup事件防止重复触发\n    state_1.colorPicker.addEventListener("input", handleColorPickerInput);\n    state_1.colorPicker.addEventListener("change", handleColorPickerChange);\n    state_1.asriChromaSlider.addEventListener("input", handleChromaSliderInput);\n    state_1.followCoverImgColorBtn.addEventListener("click", handleFollowCoverImgColorBtnClick);\n}\nfunction handleFollowSystemAccentBtnClick() {\n    // if (followSysAccentBtn?.classList.contains(\'b3-menu__item--disabled\')) return;\n    if (state_1.followSysAccentColor)\n        return;\n    (0, modeTransition_1.startFadeInFadeOutTranstition)(600, () => {\n        resetPresetPalette(false);\n        document.querySelectorAll(".asri-config.b3-menu__item--selected").forEach((el) => el.classList.remove("b3-menu__item--selected"));\n        (0, state_1.setFollowSysAccentColor)(true);\n        state_1.followSysAccentBtn.classList.add("b3-menu__item--selected");\n        // pickColorBtn!.classList.remove(\'b3-menu__item--selected\');\n        cssVarManager_1.cssVarManager.removeProperty("--asri-user-custom-accent");\n        cssVarManager_1.cssVarManager.removeProperty("--asri-cover-dominant");\n        configs_1.asriConfigs[state_1.curMode].followSysAccentColor = true;\n        configs_1.asriConfigs[state_1.curMode].followCoverImgColor = false;\n        (0, systemColor_1.getSystemAccentColor)();\n        (0, configs_1.updateAsriConfigs)();\n    });\n}\nfunction handleFollowCoverImgColorBtnClick() {\n    if (configs_1.asriConfigs[state_1.curMode].followCoverImgColor)\n        return;\n    (0, modeTransition_1.startFadeInFadeOutTranstition)(600, () => __awaiter(this, void 0, void 0, function* () {\n        resetPresetPalette();\n        (0, state_1.setFollowSysAccentColor)(false);\n        document.querySelectorAll(".asri-config.b3-menu__item--selected").forEach((el) => el.classList.remove("b3-menu__item--selected"));\n        state_1.followCoverImgColorBtn.classList.add("b3-menu__item--selected");\n        configs_1.asriConfigs[state_1.curMode].followCoverImgColor = true;\n        configs_1.asriConfigs[state_1.curMode].followSysAccentColor = false;\n        (0, coverImgColor_1.updateCoverImgColor)();\n        (0, configs_1.updateAsriConfigs)();\n    }));\n}\nfunction handlePickColorBtnClick(event) {\n    (0, modeTransition_1.startFadeInFadeOutTranstition)(600, () => {\n        resetPresetPalette();\n        if (document.documentElement.getAttribute("--asri-user-custom-accent"))\n            return;\n        (0, state_1.setFollowSysAccentColor)(false);\n        document.querySelectorAll(".asri-config.b3-menu__item--selected").forEach((el) => el.classList.remove("b3-menu__item--selected"));\n        state_1.pickColorBtn.classList.add("b3-menu__item--selected");\n        cssVarManager_1.cssVarManager.setProperty("--asri-user-custom-accent", configs_1.asriConfigs[state_1.curMode].userCustomColor);\n        cssVarManager_1.cssVarManager.removeProperty("--asri-cover-dominant");\n        configs_1.asriConfigs[state_1.curMode].userCustomColor = configs_1.asriConfigs[state_1.curMode].userCustomColor;\n        configs_1.asriConfigs[state_1.curMode].followSysAccentColor = false;\n        configs_1.asriConfigs[state_1.curMode].followCoverImgColor = false;\n        (0, util_1.handleGrayScale)(configs_1.asriConfigs[state_1.curMode].chroma);\n        (0, util_1.reverseOnPrimaryLightness)(configs_1.asriConfigs[state_1.curMode].userCustomColor);\n        (0, configs_1.updateAsriConfigs)();\n    });\n}\nconst throttledColorUpdate = (0, misc_1.throttle)((hexColor) => {\n    requestAnimationFrame(() => {\n        cssVarManager_1.cssVarManager.setProperty("--asri-user-custom-accent", hexColor);\n        (0, util_1.reverseOnPrimaryLightness)(hexColor);\n    });\n}, 400);\nfunction handleColorPickerInput() {\n    const hexColor = state_1.colorPicker.value;\n    throttledColorUpdate(hexColor);\n}\nfunction handleColorPickerChange() {\n    // resetPresetPalette();\n    state_1.followSysAccentBtn.classList.remove("b3-menu__item--selected");\n    state_1.pickColorBtn.classList.add("b3-menu__item--selected");\n    (0, util_1.reverseOnPrimaryLightness)(state_1.colorPicker.value);\n    configs_1.asriConfigs[state_1.curMode].userCustomColor = state_1.colorPicker.value;\n    (0, state_1.setFollowSysAccentColor)(false);\n    configs_1.asriConfigs[state_1.curMode].followSysAccentColor = false;\n    configs_1.asriConfigs[state_1.curMode].followCoverImgColor = false;\n    (0, configs_1.updateAsriConfigs)();\n}\nfunction handleChromaSliderInput() {\n    // if (asriChromaSlider?.classList.contains(\'b3-menu__item--disabled\')) {\n    //     this.value = asriConfigs[curMode].chroma;\n    //     return;\n    // }\n    // resetPresetPalette();\n    const chromaValue = this.value;\n    requestAnimationFrame(() => {\n        cssVarManager_1.cssVarManager.setProperty("--asri-c-factor", chromaValue);\n        this.parentElement.ariaLabel = state_1.i18n["asriChroma"] + chromaValue;\n        configs_1.asriConfigs[state_1.curMode].chroma = chromaValue;\n        (0, state_1.setIsUserAccentGray)(chromaValue === "0" ? true : false);\n        (0, util_1.handleGrayScale)(chromaValue);\n    });\n    (0, misc_1.debounce)(configs_1.updateAsriConfigs, 200)();\n}\nfunction resetPresetPalette(alterFollowSysAccentColor = true) {\n    var _a, _b;\n    const curPresetPalette = document.documentElement.getAttribute("data-asri-palette");\n    if (curPresetPalette === null)\n        return;\n    configs_1.asriConfigs[state_1.curMode].presetPalette = "";\n    (_a = document.getElementById(`prst-palette-${curPresetPalette}`)) === null || _a === void 0 ? void 0 : _a.classList.remove("b3-menu__item--selected");\n    (_b = document.getElementById("asriChroma")) === null || _b === void 0 ? void 0 : _b.classList.remove("b3-menu__item--disabled");\n    document.documentElement.removeAttribute("data-asri-palette");\n    cssVarManager_1.cssVarManager.setProperty("--asri-c-factor", configs_1.asriConfigs[state_1.curMode].chroma);\n    (0, state_1.setIsUserAccentGray)(configs_1.asriConfigs[state_1.curMode].chroma === "0" ? true : false);\n    // handleGrayScale(asriConfigs[curMode].chroma);\n    // reverseOnPrimaryLightness(!followSysAccentColor ? asriConfigs[curMode].userCustomColor : sysAccentColor);\n}\nfunction setupTfpMenuItemCallback() {\n    document.addEventListener("mouseup", tfpMenuItemCallback);\n}\nfunction removeTfpMenuItemCallback() {\n    document.removeEventListener("mouseup", tfpMenuItemCallback);\n}\nfunction tfpMenuItemCallback(e) {\n    const target = e.target.closest(\'[id^="tfp-"]\');\n    if (!target)\n        return;\n    const tfpMenuItems = document.querySelectorAll(\'[id^="tfp-"]\');\n    if (target.id === "tfp-disable") {\n        // disable all tfp features\n        document.body.classList.remove("asri-tfp-acrylic", "asri-tfp-progressive", "asri-tfp", "asri-tfp-luminous");\n        tfpMenuItems.forEach((item) => {\n            item.classList.remove("b3-menu__item--selected");\n        });\n        configs_1.asriConfigs.features.tfp = "";\n    }\n    else {\n        // enable tfp features\n        if (target.classList.contains("b3-menu__item--selected")) {\n            document.body.classList.remove("asri-tfp", target.id.replace("tfp-", "asri-tfp-"));\n            configs_1.asriConfigs.features.tfp = "";\n        }\n        else {\n            tfpMenuItems.forEach((item) => {\n                item.classList.remove("b3-menu__item--selected");\n            });\n            document.body.classList.remove("asri-tfp-acrylic", "asri-tfp-progressive", "asri-tfp-luminous");\n            document.body.classList.add("asri-tfp", target.id.replace("tfp-", "asri-tfp-"));\n            configs_1.asriConfigs.features.tfp = target.id.replace("tfp-", "");\n        }\n        target.classList.toggle("b3-menu__item--selected");\n    }\n    (0, configs_1.updateAsriConfigs)();\n}\nfunction setupPaletteMenuItemClick() {\n    document.addEventListener("mouseup", paletteMenuItemCallback);\n}\nfunction removePaletteMenuItemClick() {\n    document.removeEventListener("mouseup", paletteMenuItemCallback);\n}\nfunction paletteMenuItemCallback(e) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const target = e.target.closest(\'[id^="prst-palette-"]\');\n        if (!target)\n            return;\n        const asriChromaBtn = document.getElementById("asriChroma");\n        const paletteID = target.id;\n        const curPalette = palettes_1.asriPrstPalettes[paletteID][state_1.curMode];\n        if (configs_1.asriConfigs[state_1.curMode].presetPalette === paletteID)\n            return;\n        // document.querySelectorAll(\'[id^="prst-palette-"]\').forEach((el) => el.classList.remove("b3-menu__item--selected"));\n        (0, modeTransition_1.startFadeInFadeOutTranstition)(600, () => {\n            document.querySelectorAll(".asri-config.b3-menu__item--selected").forEach((el) => el.classList.remove("b3-menu__item--selected"));\n            asriChromaBtn === null || asriChromaBtn === void 0 ? void 0 : asriChromaBtn.classList.add("b3-menu__item--disabled");\n            target.classList.add("b3-menu__item--selected");\n            document.documentElement.setAttribute("data-asri-palette", paletteID.split("-")[2]);\n            // pickColorBtn?.classList.add("b3-menu__item--disabled");\n            // followSysAccentBtn?.classList.add("b3-menu__item--disabled");\n            // asriChromaBtn?.classList.add("b3-menu__item--disabled");\n            (0, state_1.setFollowSysAccentColor)(false);\n            state_1.followSysAccentBtn.classList.remove("b3-menu__item--selected");\n            state_1.pickColorBtn.classList.remove("b3-menu__item--selected");\n            cssVarManager_1.cssVarManager.setProperty("--asri-user-custom-accent", curPalette.primary);\n            cssVarManager_1.cssVarManager.setProperty("--asri-c-factor", curPalette.chroma);\n            cssVarManager_1.cssVarManager.removeProperty("--asri-cover-dominant");\n            (0, state_1.setIsUserAccentGray)(curPalette.chroma === "0" ? true : false);\n            configs_1.asriConfigs[state_1.curMode].presetPalette = paletteID;\n            configs_1.asriConfigs[state_1.curMode].followSysAccentColor = false;\n            configs_1.asriConfigs[state_1.curMode].followCoverImgColor = false;\n            (0, util_1.handleGrayScale)(curPalette.chroma);\n            (0, util_1.reverseOnPrimaryLightness)(curPalette.primary);\n            (0, configs_1.updateAsriConfigs)();\n        });\n    });\n}\n\n\n//# sourceURL=webpack://asri/./src/modules/asriConfigs/eventHandlers.ts?')},"./src/modules/asriConfigs/i18n.ts":function(__unused_webpack_module,exports,__webpack_require__){eval('\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.loadI18n = loadI18n;\nconst rsc_1 = __webpack_require__(/*! ../../util/rsc */ "./src/util/rsc.ts");\nfunction loadI18n() {\n    return __awaiter(this, void 0, void 0, function* () {\n        let res;\n        try {\n            if (["zh_CN", "zh_CHT", "en_US", "ar_SA"].includes(rsc_1.environment.lang)) {\n                res = yield fetch(`/appearance/themes/Asri/i18n/${rsc_1.environment.lang}.json`);\n            }\n            else {\n                res = yield fetch("/appearance/themes/Asri/i18n/en_US.json");\n            }\n            const i18n = yield res.json();\n            return i18n;\n        }\n        catch (error) {\n            console.error("failed to load i18n:", error);\n            throw error;\n        }\n    });\n}\n\n\n//# sourceURL=webpack://asri/./src/modules/asriConfigs/i18n.ts?')},"./src/modules/asriConfigs/index.ts":function(__unused_webpack_module,exports,__webpack_require__){eval('\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.loadI18n = exports.removePaletteMenuItemClick = exports.removeTfpMenuItemCallback = exports.setupPaletteMenuItemClick = exports.setupTfpMenuItemCallback = exports.initAsriConfigMenuItemClick = exports.initMenuItems = exports.createBarModeMenuItems = exports.getSystemAccentColor = exports.asriPrstPalettes = exports.updateAsriConfigs = exports.getAsriConfigs = exports.asriConfigs = exports.CSSVarManager = exports.cssVarManager = exports.initI18n = exports.unloadThemePalette = exports.loadThemePalette = void 0;\nexports.getI18n = getI18n;\n// Core functionality\nvar core_1 = __webpack_require__(/*! ./core */ "./src/modules/asriConfigs/core.ts");\nObject.defineProperty(exports, "loadThemePalette", ({ enumerable: true, get: function () { return core_1.loadThemePalette; } }));\nObject.defineProperty(exports, "unloadThemePalette", ({ enumerable: true, get: function () { return core_1.unloadThemePalette; } }));\nObject.defineProperty(exports, "initI18n", ({ enumerable: true, get: function () { return core_1.initI18n; } }));\n// CSS Variable Manager\nvar cssVarManager_1 = __webpack_require__(/*! ./cssVarManager */ "./src/modules/asriConfigs/cssVarManager.ts");\nObject.defineProperty(exports, "cssVarManager", ({ enumerable: true, get: function () { return cssVarManager_1.cssVarManager; } }));\nObject.defineProperty(exports, "CSSVarManager", ({ enumerable: true, get: function () { return cssVarManager_1.CSSVarManager; } }));\n// Configuration management\nvar configs_1 = __webpack_require__(/*! ./configs */ "./src/modules/asriConfigs/configs.ts");\nObject.defineProperty(exports, "asriConfigs", ({ enumerable: true, get: function () { return configs_1.asriConfigs; } }));\nObject.defineProperty(exports, "getAsriConfigs", ({ enumerable: true, get: function () { return configs_1.getLocalConfigs; } }));\nObject.defineProperty(exports, "updateAsriConfigs", ({ enumerable: true, get: function () { return configs_1.updateAsriConfigs; } }));\n// Palette data\nvar palettes_1 = __webpack_require__(/*! ./palettes */ "./src/modules/asriConfigs/palettes.ts");\nObject.defineProperty(exports, "asriPrstPalettes", ({ enumerable: true, get: function () { return palettes_1.asriPrstPalettes; } }));\n// State management\n__exportStar(__webpack_require__(/*! ./state */ "./src/modules/asriConfigs/state.ts"), exports);\n// System color handling\nvar systemColor_1 = __webpack_require__(/*! ./systemColor */ "./src/modules/asriConfigs/systemColor.ts");\nObject.defineProperty(exports, "getSystemAccentColor", ({ enumerable: true, get: function () { return systemColor_1.getSystemAccentColor; } }));\n// Menu items\nvar menuItems_1 = __webpack_require__(/*! ./menuItems */ "./src/modules/asriConfigs/menuItems.ts");\nObject.defineProperty(exports, "createBarModeMenuItems", ({ enumerable: true, get: function () { return menuItems_1.createBarModeMenuItems; } }));\nObject.defineProperty(exports, "initMenuItems", ({ enumerable: true, get: function () { return menuItems_1.initMenuItems; } }));\n// Event handlers\nvar eventHandlers_1 = __webpack_require__(/*! ./eventHandlers */ "./src/modules/asriConfigs/eventHandlers.ts");\nObject.defineProperty(exports, "initAsriConfigMenuItemClick", ({ enumerable: true, get: function () { return eventHandlers_1.initAsriConfigMenuItemClick; } }));\nObject.defineProperty(exports, "setupTfpMenuItemCallback", ({ enumerable: true, get: function () { return eventHandlers_1.setupTfpMenuItemCallback; } }));\nObject.defineProperty(exports, "setupPaletteMenuItemClick", ({ enumerable: true, get: function () { return eventHandlers_1.setupPaletteMenuItemClick; } }));\nObject.defineProperty(exports, "removeTfpMenuItemCallback", ({ enumerable: true, get: function () { return eventHandlers_1.removeTfpMenuItemCallback; } }));\nObject.defineProperty(exports, "removePaletteMenuItemClick", ({ enumerable: true, get: function () { return eventHandlers_1.removePaletteMenuItemClick; } }));\n// I18n\nvar i18n_1 = __webpack_require__(/*! ./i18n */ "./src/modules/asriConfigs/i18n.ts");\nObject.defineProperty(exports, "loadI18n", ({ enumerable: true, get: function () { return i18n_1.loadI18n; } }));\n// Initialize and export for backward compatibility\nconst core_2 = __webpack_require__(/*! ./core */ "./src/modules/asriConfigs/core.ts");\n// This function should be called to initialize i18n if needed\nfunction getI18n() {\n    return __awaiter(this, void 0, void 0, function* () {\n        return yield (0, core_2.initI18n)();\n    });\n}\n\n\n//# sourceURL=webpack://asri/./src/modules/asriConfigs/index.ts?')},"./src/modules/asriConfigs/menuItems.ts":function(__unused_webpack_module,exports,__webpack_require__){eval('\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.createBarModeMenuItems = createBarModeMenuItems;\nexports.initMenuItems = initMenuItems;\nconst misc_1 = __webpack_require__(/*! ../../util/misc */ "./src/util/misc.ts");\nconst configs_1 = __webpack_require__(/*! ./configs */ "./src/modules/asriConfigs/configs.ts");\nconst eventHandlers_1 = __webpack_require__(/*! ./eventHandlers */ "./src/modules/asriConfigs/eventHandlers.ts");\nconst palettes_1 = __webpack_require__(/*! ./palettes */ "./src/modules/asriConfigs/palettes.ts");\nconst state_1 = __webpack_require__(/*! ./state */ "./src/modules/asriConfigs/state.ts");\nconst paletteMenuItem = (paletteID) => {\n    const displayName = state_1.i18n[paletteID] || paletteID;\n    return `<button class="b3-menu__item asri-config" id="${paletteID}"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"/><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"/><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"/></g></svg><span class="b3-menu__label">${displayName}</span></button>`;\n};\nfunction createBarModeMenuItems(e) {\n    return __awaiter(this, void 0, void 0, function* () {\n        var _a, _b;\n        if (e.type !== "mouseup")\n            return;\n        const target = e.target;\n        const targetItem = target.closest(".toolbar__item");\n        if (!targetItem)\n            return;\n        // use existing menu items if any\n        if (document.querySelector(".asri-config"))\n            return;\n        // create menu items when there is no existing menu items\n        let barModeMenuItems = yield (0, misc_1.querySelectorAsync)(\'#commonMenu[data-name="barmode"] .b3-menu__items\', document, 2, 0);\n        if (!barModeMenuItems)\n            return;\n        const asriConfigMenuHTML = `\n        <button class="b3-menu__separator asri-config"></button>\n        <div class="menu-item__subtitle" style="user-select: none;">${state_1.i18n["palette-presets"]}</div>\n        ${Object.keys(palettes_1.asriPrstPalettes)\n            .map((paletteID) => paletteMenuItem(paletteID))\n            .join("")}\n        <button class="b3-menu__separator asri-config"></button>\n        <button class="b3-menu__item asri-config" id="pickColor">\n            <svg class="b3-menu__icon"></svg>\n            <input id="asriColorPicker" type="color" value="${configs_1.asriConfigs[state_1.curMode].userCustomColor}">\n            <label for="asriColorPicker" class="be-menu__label">${state_1.i18n["pickColor"]}</label>\n        </button>\n        <button class="b3-menu__item asri-config" id="followSysAccent">\n            <svg class="b3-menu__icon"></svg>\n            <label for="" class="be-menu__label">${state_1.i18n["followSysAccent"]}</label>\n        </button>\n        <button class="b3-menu__item asri-config" id="followCoverImgColor">\n            <svg class="b3-menu__icon"></svg>\n            <label for="" class="be-menu__label">${state_1.i18n["followCoverImgColor"] || "follow cover img color"}</label>\n        </button>\n        <button class="b3-menu__item asri-config" data-type="nobg" id="asriChroma">\n            <svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">\n                <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 11l-8-8l-8.6 8.6a2 2 0 0 0 0 2.8l5.2 5.2c.8.8 2 .8 2.8 0zM5 2l5 5m-8 6h15m5 7a2 2 0 1 1-4 0c0-1.6 1.7-2.4 2-4c.3 1.6 2 2.4 2 4" />\n            </svg>\n            <div aria-label="${state_1.i18n["asriChroma"] + ((_b = (_a = state_1.asriChromaSlider === null || state_1.asriChromaSlider === void 0 ? void 0 : state_1.asriChromaSlider.value) !== null && _a !== void 0 ? _a : configs_1.asriConfigs[state_1.curMode].chroma) !== null && _b !== void 0 ? _b : "1")}" class="b3-tooltips b3-tooltips__n">\n                <input style="box-sizing: border-box" type="range" id="asriChromaSlider" class="b3-slider fn__block" min="0" max="5" step="0.1" value="1">\n            </div>\n        </button>\n        <button class="b3-menu__separator asri-config"></button>\n        <button class="b3-menu__item asri-config" id="topbarFusionPlus"></button>\n`;\n        const asriConfigFrag = document.createRange().createContextualFragment(asriConfigMenuHTML);\n        barModeMenuItems.appendChild(asriConfigFrag);\n        // set funcitons for menu items\n        (0, state_1.setFollowSysAccentBtn)(document.getElementById("followSysAccent"));\n        (0, state_1.setFollowCoverImgColorBtn)(document.getElementById("followCoverImgColor"));\n        (0, state_1.setPickColorBtn)(document.getElementById("pickColor"));\n        (0, state_1.setAsriChromaSlider)(document.getElementById("asriChromaSlider"));\n        (0, state_1.setColorPicker)(state_1.pickColorBtn.querySelector("input"));\n        (0, state_1.setTopbarFusionPlusBtn)(document.getElementById("topbarFusionPlus"));\n        const topbarFusionPlusBtn = document.getElementById("topbarFusionPlus");\n        if (topbarFusionPlusBtn) {\n            topbarFusionPlusBtn.innerHTML = `\n        <svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 22"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="m8 10.5l6.492-6.492M13.496 16L20 9.496zm-4.91-.586L19.413 4.587M8 6a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-8a2 2 0 0 1-2-2z"/><path d="M16 16v2a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2"/></g></svg>\n        <span class="b3-menu__label" style="display: flex">${state_1.i18n["topbarFusionPlus"]}<svg data-position="north" class="b3-menu__icon ariaLabel asri-experimental" aria-label=${\'"\' + state_1.i18n["tfp-experimental"] + \'"\'} style="vertical-align: -.1em; height: .8em; width: .8em; opacity: .5; padding-inline-start: .1em; margin-right: unset;margin-inline-start: auto; margin-inline-end: 0;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 23 23"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2M6.453 15h11.094M8.5 2h7"/></svg></span>\n        <svg class="b3-menu__icon b3-menu__icon--small">\n            <use xlink:href="#iconRight"></use>\n        </svg>\n        <div class="b3-menu__submenu">\n            <div class="b3-menu__items">\n                <button class="b3-menu__item" id="tfp-luminous">\n                    <svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 22"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="m8 10.5l6.492-6.492M13.496 16L20 9.496zm-4.91-.586L19.413 4.587M8 6a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-8a2 2 0 0 1-2-2z"/><path d="M16 16v2a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2"/></g></svg>\n                    <span class="b3-menu__label">${state_1.i18n["tfp-luminous"]}</span>\n                </button>\n                <button class="b3-menu__item" id="tfp-progressive">\n                    <svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 22"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="m8 10.5l6.492-6.492M13.496 16L20 9.496zm-4.91-.586L19.413 4.587M8 6a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-8a2 2 0 0 1-2-2z"/><path d="M16 16v2a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2"/></g></svg>\n                    <span class="b3-menu__label">${state_1.i18n["tfp-progressive"]}</span>\n                </button>                                \n                <button class="b3-menu__item" id="tfp-acrylic">\n                    <svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 22"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="m8 10.5l6.492-6.492M13.496 16L20 9.496zm-4.91-.586L19.413 4.587M8 6a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-8a2 2 0 0 1-2-2z"/><path d="M16 16v2a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2"/></g></svg>\n                    <span class="b3-menu__label">${state_1.i18n["tfp-acrylic"]}</span>\n                </button>                \n                <button class="b3-menu__separator"></button>\n                <button class="b3-menu__item" id="tfp-disable">\n                    <svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">\n                        <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="m15 9l-6 6m0-6l6 6"/></g>\n                    </svg>\n                    <span class="b3-menu__label">${state_1.i18n["tfp-disable"]}</span>\n                </button>\n            </div>\n        </div>\n    `;\n        }\n        if (!state_1.followSysAccentBtn || !state_1.pickColorBtn || !state_1.asriChromaSlider || !state_1.colorPicker)\n            return;\n        initMenuItems();\n        (0, eventHandlers_1.initAsriConfigMenuItemClick)();\n    });\n}\nfunction initMenuItems() {\n    // check local configs to determine the initial state of the menu items\n    const asriChromaBtn = document.getElementById("asriChroma");\n    (0, state_1.setTfpProgressiveBtn)(document.getElementById("tfp-progressive"));\n    (0, state_1.setTfpAcrylicBtn)(document.getElementById("tfp-acrylic"));\n    (0, state_1.setTfpLuminousBtn)(document.getElementById("tfp-luminous"));\n    (0, state_1.setFollowCoverImgColorBtn)(document.getElementById("followCoverImgColor"));\n    // if (asriConfigs[curMode].presetPalette) {\n    //   pickColorBtn?.classList.add("b3-menu__item--disabled");\n    //   followSysAccentBtn?.classList.add("b3-menu__item--disabled");\n    //   asriChromaBtn?.classList.add("b3-menu__item--disabled");\n    // }\n    state_1.followSysAccentBtn.classList.toggle("b3-menu__item--selected", !configs_1.asriConfigs[state_1.curMode].presetPalette && state_1.followSysAccentColor);\n    state_1.followCoverImgColorBtn.classList.toggle("b3-menu__item--selected", configs_1.asriConfigs[state_1.curMode].followCoverImgColor && !configs_1.asriConfigs[state_1.curMode].presetPalette && !state_1.followSysAccentColor);\n    state_1.pickColorBtn.classList.toggle("b3-menu__item--selected", !configs_1.asriConfigs[state_1.curMode].presetPalette && !state_1.followSysAccentColor && !configs_1.asriConfigs[state_1.curMode].followCoverImgColor);\n    state_1.asriChromaSlider.value = configs_1.asriConfigs[state_1.curMode].chroma || "1";\n    state_1.asriChromaSlider.parentElement.ariaLabel = state_1.i18n["asriChroma"] + configs_1.asriConfigs[state_1.curMode].chroma;\n    if (configs_1.asriConfigs[state_1.curMode].presetPalette) {\n        const curPalette = document.getElementById(`${configs_1.asriConfigs[state_1.curMode].presetPalette}`);\n        asriChromaBtn === null || asriChromaBtn === void 0 ? void 0 : asriChromaBtn.classList.add("b3-menu__item--disabled");\n        curPalette === null || curPalette === void 0 ? void 0 : curPalette.classList.add("b3-menu__item--selected");\n    }\n    [state_1.tfpProgressiveBtn, state_1.tfpAcrylicBtn, state_1.tfpLuminousBtn].forEach((btn) => {\n        if (btn) {\n            const type = btn.id.replace("tfp-", "");\n            btn.classList.toggle("b3-menu__item--selected", configs_1.asriConfigs.features.tfp === type);\n        }\n    });\n}\n\n\n//# sourceURL=webpack://asri/./src/modules/asriConfigs/menuItems.ts?')},"./src/modules/asriConfigs/palettes.ts":(__unused_webpack_module,exports)=>{eval('\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.asriPrstPalettes = void 0;\nexports.asriPrstPalettes = {\n    "prst-palette-auriflow": {\n        "dark": {\n            "primary": "#D2B983",\n            "chroma": "0.3",\n            "followSysAccentColor": false,\n        },\n        "light": {\n            "primary": "#F4D18B",\n            "chroma": "0",\n            "followSysAccentColor": false,\n        },\n    },\n    "prst-palette-everbliss": {\n        "dark": {\n            "primary": "#13012a",\n            "chroma": "1.5",\n            "followSysAccentColor": false,\n        },\n        "light": {\n            "primary": "#F4CA57",\n            "chroma": "2.8",\n            "followSysAccentColor": false,\n        },\n    },\n    "prst-palette-aerisland": {\n        "dark": {\n            "primary": "#111a3f",\n            "chroma": "2",\n            "followSysAccentColor": false,\n        },\n        "light": {\n            "primary": "#e6f9db", // 饱和度需要高一点，修复Safari显示为红色的问题\n            "chroma": "2",\n            "followSysAccentColor": false,\n        },\n    },\n    "prst-palette-zerith": {\n        "dark": {\n            "primary": "#ABC3D9",\n            "chroma": "2.4",\n            "followSysAccentColor": false,\n        },\n        "light": {\n            "primary": "#C2E2DF",\n            "chroma": "0.7",\n            "followSysAccentColor": false,\n        },\n    },\n    "prst-palette-polar": {\n        "dark": {\n            "primary": "#E6E9EF",\n            "chroma": "0",\n            "followSysAccentColor": false,\n        },\n        "light": {\n            "primary": "#1B1C1D",\n            "chroma": "0",\n            "followSysAccentColor": false,\n        },\n    },\n    "prst-palette-stellula": {\n        "dark": {\n            "primary": "#3B2731",\n            "chroma": "0.6",\n            "followSysAccentColor": false,\n        },\n        "light": {\n            "primary": "#FFF4EB",\n            "chroma": "2.5",\n            "followSysAccentColor": false,\n        },\n    },\n    "prst-palette-vael": {\n        "dark": {\n            "primary": "#96c4df",\n            "chroma": "2.5",\n            "followSysAccentColor": false,\n        },\n        "light": {\n            "primary": "#FFFCF3",\n            "chroma": "1.2",\n            "followSysAccentColor": false,\n        },\n    },\n};\n\n\n//# sourceURL=webpack://asri/./src/modules/asriConfigs/palettes.ts?')},"./src/modules/asriConfigs/state.ts":(__unused_webpack_module,exports)=>{eval('\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.setTfpLuminousBtn = exports.setTfpAcrylicBtn = exports.setTfpProgressiveBtn = exports.setTopbarFusionPlusBtn = exports.setColorPicker = exports.setAsriChromaSlider = exports.setPickColorBtn = exports.setFollowCoverImgColorBtn = exports.setFollowSysAccentBtn = exports.setFollowSysAccentColor = exports.setIsCoverImgColorGray = exports.setIsUserAccentGray = exports.setIsSysAccentGray = exports.setSysAccentColor = exports.setI18n = exports.setCurMode = exports.tfpLuminousBtn = exports.tfpAcrylicBtn = exports.tfpProgressiveBtn = exports.topbarFusionPlusBtn = exports.colorPicker = exports.asriChromaSlider = exports.pickColorBtn = exports.followCoverImgColorBtn = exports.followSysAccentBtn = exports.followSysAccentColor = exports.isCoverImgColorGray = exports.isUserAccentGray = exports.isSysAccentGray = exports.sysAccentColor = exports.i18n = exports.curMode = void 0;\nexports.isSysAccentGray = false;\nexports.isUserAccentGray = false;\nexports.isCoverImgColorGray = false;\nexports.followSysAccentColor = false;\n// 状态设置函数\nconst setCurMode = (mode) => {\n    exports.curMode = mode;\n};\nexports.setCurMode = setCurMode;\nconst setI18n = (i18nData) => {\n    exports.i18n = i18nData;\n};\nexports.setI18n = setI18n;\nconst setSysAccentColor = (color) => {\n    exports.sysAccentColor = color;\n};\nexports.setSysAccentColor = setSysAccentColor;\nconst setIsSysAccentGray = (value) => {\n    exports.isSysAccentGray = value;\n};\nexports.setIsSysAccentGray = setIsSysAccentGray;\nconst setIsUserAccentGray = (value) => {\n    exports.isUserAccentGray = value;\n};\nexports.setIsUserAccentGray = setIsUserAccentGray;\nconst setIsCoverImgColorGray = (value) => {\n    exports.isCoverImgColorGray = value;\n};\nexports.setIsCoverImgColorGray = setIsCoverImgColorGray;\nconst setFollowSysAccentColor = (value) => {\n    exports.followSysAccentColor = value;\n};\nexports.setFollowSysAccentColor = setFollowSysAccentColor;\nconst setFollowSysAccentBtn = (element) => {\n    exports.followSysAccentBtn = element;\n};\nexports.setFollowSysAccentBtn = setFollowSysAccentBtn;\nconst setFollowCoverImgColorBtn = (element) => {\n    exports.followCoverImgColorBtn = element;\n};\nexports.setFollowCoverImgColorBtn = setFollowCoverImgColorBtn;\nconst setPickColorBtn = (element) => {\n    exports.pickColorBtn = element;\n};\nexports.setPickColorBtn = setPickColorBtn;\nconst setAsriChromaSlider = (element) => {\n    exports.asriChromaSlider = element;\n};\nexports.setAsriChromaSlider = setAsriChromaSlider;\nconst setColorPicker = (element) => {\n    exports.colorPicker = element;\n};\nexports.setColorPicker = setColorPicker;\nconst setTopbarFusionPlusBtn = (element) => {\n    exports.topbarFusionPlusBtn = element;\n};\nexports.setTopbarFusionPlusBtn = setTopbarFusionPlusBtn;\nconst setTfpProgressiveBtn = (element) => {\n    exports.tfpProgressiveBtn = element;\n};\nexports.setTfpProgressiveBtn = setTfpProgressiveBtn;\nconst setTfpAcrylicBtn = (element) => {\n    exports.tfpAcrylicBtn = element;\n};\nexports.setTfpAcrylicBtn = setTfpAcrylicBtn;\nconst setTfpLuminousBtn = (element) => {\n    exports.tfpLuminousBtn = element;\n};\nexports.setTfpLuminousBtn = setTfpLuminousBtn;\n\n\n//# sourceURL=webpack://asri/./src/modules/asriConfigs/state.ts?')},"./src/modules/asriConfigs/systemColor.ts":(__unused_webpack_module,exports,__webpack_require__)=>{eval('\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.getSystemAccentColor = getSystemAccentColor;\nconst electron_1 = __webpack_require__(/*! ../../util/electron */ "./src/util/electron.ts");\nconst colorTools_1 = __webpack_require__(/*! ../../util/colorTools */ "./src/util/colorTools.ts");\nconst rsc_1 = __webpack_require__(/*! ../../util/rsc */ "./src/util/rsc.ts");\nconst cssVarManager_1 = __webpack_require__(/*! ./cssVarManager */ "./src/modules/asriConfigs/cssVarManager.ts");\nconst state_1 = __webpack_require__(/*! ./state */ "./src/modules/asriConfigs/state.ts");\nconst util_1 = __webpack_require__(/*! ./util */ "./src/modules/asriConfigs/util.ts");\nfunction getSystemAccentColor() {\n    if (rsc_1.environment.isInBrowser || rsc_1.environment.isMobile || rsc_1.environment.isLinux)\n        return;\n    const accent = electron_1.remote.systemPreferences.getAccentColor();\n    const accentHex = "#" + accent.slice(0, 6);\n    const accentHsl = (0, colorTools_1.hexToHSL)(accentHex);\n    if (!accentHsl)\n        return;\n    if (state_1.sysAccentColor !== accentHex) {\n        cssVarManager_1.cssVarManager.setProperty("--asri-sys-accent", accentHex);\n        if (accentHsl.s > 0.28)\n            cssVarManager_1.cssVarManager.setProperty("--asri-sys-accent-accessible", accentHex);\n        else\n            cssVarManager_1.cssVarManager.removeProperty("--asri-sys-accent-accessible");\n        (0, state_1.setIsSysAccentGray)(accentHsl.s === 0 ? true : false);\n        (0, state_1.setSysAccentColor)(accentHex);\n    }\n    if (state_1.followSysAccentColor) {\n        (0, util_1.handleGrayScale)(accentHsl.s);\n        (0, util_1.reverseOnPrimaryLightness)(accentHex);\n    }\n}\n\n\n//# sourceURL=webpack://asri/./src/modules/asriConfigs/systemColor.ts?')},"./src/modules/asriConfigs/util.ts":(__unused_webpack_module,exports,__webpack_require__)=>{eval('\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.reverseThreshold = void 0;\nexports.handleGrayScale = handleGrayScale;\nexports.reverseOnPrimaryLightness = reverseOnPrimaryLightness;\nexports.addHdrSupportImage = addHdrSupportImage;\nexports.removeHdrSupportImage = removeHdrSupportImage;\nconst colorTools_1 = __webpack_require__(/*! ../../util/colorTools */ "./src/util/colorTools.ts");\nconst rsc_1 = __webpack_require__(/*! ../../util/rsc */ "./src/util/rsc.ts");\nconst configs_1 = __webpack_require__(/*! ./configs */ "./src/modules/asriConfigs/configs.ts");\nconst cssVarManager_1 = __webpack_require__(/*! ./cssVarManager */ "./src/modules/asriConfigs/cssVarManager.ts");\nconst state_1 = __webpack_require__(/*! ./state */ "./src/modules/asriConfigs/state.ts");\nexports.reverseThreshold = rsc_1.environment.appSchemeMode === "light" ? 0.74 : 0.79;\n/**\n * decide if use grayscale or not, if so return true, otherwise return false\n * @param {string | number} chroma\n * @returns boolean\n */\nfunction handleGrayScale(chroma) {\n    const chromaValue = String(chroma);\n    // console.log(\'chroma\', chroma, \'followSysAccentColor\', followSysAccentColor, \'isSysAccentGray\', isSysAccentGray, \'isUserAccentGray\', isUserAccentGray, \'isCoverImgColorGray\', isCoverImgColorGray, "addCfactor0", chromaValue === "0" || (followSysAccentColor && isSysAccentGray) || isUserAccentGray || (isCoverImgColorGray && asriConfigs[curMode].followCoverImgColor));\n    if (chromaValue === "0" ||\n        (state_1.followSysAccentColor && state_1.isSysAccentGray) ||\n        state_1.isUserAccentGray ||\n        (state_1.isCoverImgColorGray && configs_1.asriConfigs[state_1.curMode].followCoverImgColor)) {\n        console.log("addCfactor0");\n        requestAnimationFrame(() => {\n            cssVarManager_1.cssVarManager.setProperty("--asri-c-0", "0");\n            document.body.classList.add("asri-c-0");\n            addHdrSupportImage();\n        });\n        return true;\n    }\n    else {\n        requestAnimationFrame(() => {\n            cssVarManager_1.cssVarManager.removeProperty("--asri-c-0");\n            document.body.classList.remove("asri-c-0");\n            removeHdrSupportImage();\n        });\n        return false;\n    }\n}\nfunction reverseOnPrimaryLightness(hex) {\n    const { L } = (0, colorTools_1.hexToOklch)(hex) || {};\n    console.log("reverseOnPrimaryLightness", hex, L);\n    if (L === undefined)\n        return;\n    if (L > exports.reverseThreshold) {\n        cssVarManager_1.cssVarManager.setProperty("--asri-on-primary-reverse", rsc_1.environment.appSchemeMode === "light" ? ".3" : ".2");\n    }\n    else {\n        cssVarManager_1.cssVarManager.removeProperty("--asri-on-primary-reverse");\n    }\n}\nfunction addHdrSupportImage() {\n    // 检查浏览器是否支持HDR\n    if (window.matchMedia &&\n        window.matchMedia("(color-gamut: p3)").matches &&\n        !document.querySelector(".asri-hdr-support-image") &&\n        rsc_1.environment.appSchemeMode === "light") {\n        const img = document.createElement("img");\n        img.src = "/appearance/themes/Asri/hdr.jpg"; // source: https://github.com/ardov/hdr-web\n        img.style.position = "fixed";\n        img.style.pointerEvents = "none";\n        img.style.width = "1px";\n        img.style.height = "1px";\n        img.classList.add("asri-hdr-support-image");\n        document.body.appendChild(img);\n    }\n}\nfunction removeHdrSupportImage() {\n    const hdrImage = document.querySelector(".asri-hdr-support-image");\n    if (hdrImage) {\n        hdrImage.remove();\n    }\n}\n\n\n//# sourceURL=webpack://asri/./src/modules/asriConfigs/util.ts?')},"./src/modules/docks.ts":function(__unused_webpack_module,exports,__webpack_require__){eval('\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.updateDockLBgAndBorder = updateDockLBgAndBorder;\nexports.addDockbClassName = addDockbClassName;\nexports.removeDockbClassName = removeDockbClassName;\nexports.destroyDockBg = destroyDockBg;\nconst misc_1 = __webpack_require__(/*! ../util/misc */ "./src/util/misc.ts");\nconst rsc_1 = __webpack_require__(/*! ../util/rsc */ "./src/util/rsc.ts");\nconst interfaceState_1 = __webpack_require__(/*! ../util/interfaceState */ "./src/util/interfaceState.ts");\nfunction updateDockLBgAndBorder() {\n    return __awaiter(this, void 0, void 0, function* () {\n        const dockL = rsc_1.asriDoms.dockL ? rsc_1.asriDoms.dockL : yield (0, misc_1.querySelectorAsync)("#dockLeft");\n        if (!rsc_1.asriDoms.layoutDockL)\n            yield (0, misc_1.querySelectorAsync)(".layout__dockl");\n        const dockR = rsc_1.asriDoms.dockR;\n        for (let dock of [dockL, dockR]) {\n            let isDockLLytPinned = (0, interfaceState_1.isDockLytPinned)(dock === dockL ? "L" : "R"), isDockLLytExpanded = (0, interfaceState_1.isDockLytExpanded)(dock === dockL ? "L" : "R");\n            // console.log(\'measure: dock\' , dock)\n            if (isDockLLytPinned && isDockLLytExpanded) {\n                dock === null || dock === void 0 ? void 0 : dock.classList.add("dock-layout-expanded");\n            }\n            else {\n                dock === null || dock === void 0 ? void 0 : dock.classList.remove("dock-layout-expanded");\n            }\n            // console.log(\'mutate: dock\' , dock)\n        }\n    });\n}\nfunction addDockbClassName() {\n    return __awaiter(this, void 0, void 0, function* () {\n        var _a, _b, _c;\n        if (rsc_1.environment.isMobile)\n            return;\n        const dockbExist = yield (0, interfaceState_1.hasDockb)();\n        const dockbFloat = !(0, interfaceState_1.isDockLytPinned)("B") && (0, interfaceState_1.isDockLytExpanded)("B");\n        (_a = rsc_1.asriDoms.toolbar) === null || _a === void 0 ? void 0 : _a.nextElementSibling.classList.toggle("has-dockb", dockbExist);\n        (_b = rsc_1.asriDoms.toolbar) === null || _b === void 0 ? void 0 : _b.nextElementSibling.classList.toggle("has-layout-dockb-float", dockbFloat);\n        (_c = rsc_1.asriDoms.dockB) === null || _c === void 0 ? void 0 : _c.classList.toggle("has-layout-dockb-float", dockbFloat);\n    });\n}\nfunction removeDockbClassName() {\n    var _a, _b;\n    (_a = rsc_1.asriDoms.toolbar) === null || _a === void 0 ? void 0 : _a.nextElementSibling.classList.remove("has-dockb");\n    (_b = rsc_1.asriDoms.toolbar) === null || _b === void 0 ? void 0 : _b.nextElementSibling.classList.remove("has-layout-dockb-float");\n}\nfunction destroyDockBg() {\n    var _a;\n    (_a = document.querySelector(".dock-layout-expanded")) === null || _a === void 0 ? void 0 : _a.classList.remove("dock-layout-expanded");\n}\n\n\n//# sourceURL=webpack://asri/./src/modules/docks.ts?')},"./src/modules/env.ts":(__unused_webpack_module,exports,__webpack_require__)=>{eval('\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.addEnvClassNames = addEnvClassNames;\nexports.removeEnvClassNames = removeEnvClassNames;\nconst rsc_1 = __webpack_require__(/*! ../util/rsc */ "./src/util/rsc.ts");\nconst envClassifiers = [\n    { condition: rsc_1.environment.isMacOS, className: "body-asri--mac" },\n    { condition: rsc_1.environment.isLinux, className: "body-asri--linux" },\n    { condition: rsc_1.environment.isMobile, className: "body-asri--mobile" },\n    { condition: rsc_1.environment.isInBrowser, className: "body-asri--browser" },\n    { condition: rsc_1.environment.isAndroid, className: "body-asri--android" },\n    { condition: rsc_1.environment.isIOSApp, className: "body-asri--iosApp" },\n    { condition: rsc_1.environment.isReadOnly, className: "body-asri--readOnly" },\n    { condition: rsc_1.environment.isSafari, className: "body-asri--safari" },\n];\nfunction addEnvClassNames() {\n    envClassifiers.forEach(({ condition, className }) => {\n        if (condition) {\n            document.body.classList.add(className);\n        }\n    });\n}\nfunction removeEnvClassNames() {\n    envClassifiers.forEach(({ className }) => {\n        document.body.classList.remove(className);\n    });\n}\n\n\n//# sourceURL=webpack://asri/./src/modules/env.ts?')},"./src/modules/focusedBlock.ts":(__unused_webpack_module,exports)=>{eval('\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.selectionChangeCallback = selectionChangeCallback;\nexports.removeFocusedBlockClass = removeFocusedBlockClass;\nfunction selectionChangeCallback(e) {\n    // fix https://github.com/mustakshif/Asri/issues/133\n    // 创建一个 Promise，等待 mouseup 事件\n    const mouseUpPromise = new Promise((resolve) => {\n        const mouseUpHandlerForSelectedBlock = () => {\n            document.removeEventListener("mouseup", mouseUpHandlerForSelectedBlock, true);\n            resolve();\n        };\n        document.addEventListener("mouseup", mouseUpHandlerForSelectedBlock, true);\n    });\n    // 创建一个 Promise，等待 0.3 秒\n    const timeoutPromise = new Promise((resolve) => {\n        setTimeout(resolve, 300);\n    });\n    // 创建一个 Promise，等待 keyup 事件\n    const keyUpPromise = new Promise((resolve) => {\n        const keyUpHandlerForSelectedBlock = () => {\n            document.removeEventListener("keyup", keyUpHandlerForSelectedBlock, true);\n            resolve();\n        };\n        document.addEventListener("keyup", keyUpHandlerForSelectedBlock, true);\n    });\n    // 使用 Promise.race 等待 mouseup 事件、keyup 事件或 0.3 秒\n    Promise.race([mouseUpPromise, keyUpPromise, timeoutPromise]).then(() => {\n        const selection = window.getSelection();\n        const range = selection && selection.rangeCount > 0 ? selection.getRangeAt(0) : null;\n        if (!range)\n            return;\n        const curNode = range.commonAncestorContainer;\n        const curParent = curNode.parentElement;\n        const curBlock = curParent ? curParent.closest("[data-node-id]") : null;\n        if (!curBlock)\n            return;\n        const curBlockType = curBlock.getAttribute("data-type");\n        removeFocusedBlockClass();\n        if (!curBlockType || ["NodeAttributeView", "NodeCodeBlock", "NodeList", "NodeHTMLBlock", "NodeCallout"].includes(curBlockType))\n            return;\n        curBlock.classList.add("asri-selected-block");\n        // console.log(selection, range, curNode, curBlock, curBlockType);\n    });\n}\nfunction removeFocusedBlockClass() {\n    document.querySelectorAll(".asri-selected-block").forEach((block) => block.classList.remove("asri-selected-block"));\n}\n// export function handleFocusedBlockChange() {\n//     const selection = window.getSelection();\n//     const range = selection && selection.rangeCount > 0 ? selection.getRangeAt(0) : null;\n//     if (!range) return;\n//     const curNode = range.commonAncestorContainer;\n//     const curParent = curNode.parentElement;\n//     const curBlock = curParent ? curNode.parentElement.closest(\'[data-node-id]\') : null;\n//     if (!curBlock) return;\n//     curParent && curParent.dir && curParent.dir === \'auto\';\n//     const curBlockType = curBlock.getAttribute(\'data-type\');\n//     document.querySelectorAll(\'.asri-selected-block\').forEach(block => block.classList.remove(\'asri-selected-block\'));\n//     if (curBlockType === \'NodeAttributeView\' || !curBlockType || curBlockType === \'NodeCodeBlock\') return;\n//     curBlock.classList.add(\'asri-selected-block\');\n// }\n\n\n//# sourceURL=webpack://asri/./src/modules/focusedBlock.ts?')},"./src/modules/index.ts":function(__unused_webpack_module,exports,__webpack_require__){eval('\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.loadAsriJSModules = loadAsriJSModules;\nexports.unloadAsriJSModules = unloadAsriJSModules;\nconst interfaceState_1 = __webpack_require__(/*! ../util/interfaceState */ "./src/util/interfaceState.ts");\nconst misc_1 = __webpack_require__(/*! ../util/misc */ "./src/util/misc.ts");\nconst rsc_1 = __webpack_require__(/*! ../util/rsc */ "./src/util/rsc.ts");\nconst MOConfigForClassNames = {\n    attributes: true,\n    subtree: true,\n    attributeFilter: ["class"],\n    attributeOldValue: true,\n};\nconst afwd_1 = __webpack_require__(/*! ./afwd */ "./src/modules/afwd.ts");\nconst asriConfigs_1 = __webpack_require__(/*! ./asriConfigs */ "./src/modules/asriConfigs/index.ts");\nconst coverImgColor_1 = __webpack_require__(/*! ./asriConfigs/coverImgColor */ "./src/modules/asriConfigs/coverImgColor.ts");\nconst util_1 = __webpack_require__(/*! ./asriConfigs/util */ "./src/modules/asriConfigs/util.ts");\nconst docks_1 = __webpack_require__(/*! ./docks */ "./src/modules/docks.ts");\nconst env_1 = __webpack_require__(/*! ./env */ "./src/modules/env.ts");\nconst focusedBlock_1 = __webpack_require__(/*! ./focusedBlock */ "./src/modules/focusedBlock.ts");\nconst modeTransition_1 = __webpack_require__(/*! ./modeTransition */ "./src/modules/modeTransition.ts");\nconst protyleStatus_1 = __webpack_require__(/*! ./protyleStatus */ "./src/modules/protyleStatus.ts");\nconst scrollbar_1 = __webpack_require__(/*! ./scrollbar */ "./src/modules/scrollbar.ts");\nconst sidepanels_1 = __webpack_require__(/*! ./sidepanels */ "./src/modules/sidepanels.ts");\nconst topbarFusion_1 = __webpack_require__(/*! ./topbarFusion */ "./src/modules/topbarFusion.ts");\nconst trafficLights_1 = __webpack_require__(/*! ./trafficLights */ "./src/modules/trafficLights.ts");\nconst vibrancy_1 = __webpack_require__(/*! ./vibrancy */ "./src/modules/vibrancy.ts");\nconst globalClassNameMo = new MutationObserver(globalClassNameMoCallback);\nconst lytCenterRo = new ResizeObserver(lytCenterRoCallback);\nconst winRo = new ResizeObserver(winRoCallback);\nlet isWinResizing = false;\nlet protyleWidthChange = 0;\nfunction loadAsriJSModules() {\n    return __awaiter(this, void 0, void 0, function* () {\n        (0, env_1.addEnvClassNames)();\n        (0, scrollbar_1.useMacSysScrollbar)();\n        (0, trafficLights_1.applyTrafficLightPosition)();\n        (0, protyleStatus_1.toggleProtyleStatus)();\n        yield (0, asriConfigs_1.getI18n)();\n        (0, asriConfigs_1.loadThemePalette)(); // https://github.com/mustakshif/Asri/issues/85\n        (0, vibrancy_1.setVibrancy)();\n        if (!rsc_1.environment.isMobile) {\n            yield (0, interfaceState_1.updateWndEls)();\n            yield (0, topbarFusion_1.updateDragRect)("initials");\n            (0, topbarFusion_1.createTopbarFusionElements)();\n        }\n        updateStyles();\n        (0, docks_1.addDockbClassName)();\n        document.addEventListener("mouseup", lowFreqEventsCallback);\n        document.addEventListener("dragend", lowFreqEventsCallback);\n        document.addEventListener("keyup", lowFreqEventsCallback, true);\n        window.addEventListener("focus", winFocusChangeCallback);\n        window.addEventListener("blur", winFocusChangeCallback);\n        document.addEventListener("selectionchange", focusedBlock_1.selectionChangeCallback);\n        globalClassNameMo.observe(document.body, MOConfigForClassNames);\n        (0, asriConfigs_1.setupPaletteMenuItemClick)();\n        (0, asriConfigs_1.setupTfpMenuItemCallback)();\n        rsc_1.asriDoms.layoutCenter || (yield (0, misc_1.querySelectorAsync)(".layout__center"));\n        if (!rsc_1.environment.isMobile) {\n            lytCenterRo.observe(rsc_1.asriDoms.layoutCenter);\n            winRo.observe(document.body);\n        }\n    });\n}\nfunction unloadAsriJSModules() {\n    return __awaiter(this, arguments, void 0, function* (completeUnload = true) {\n        if (completeUnload) {\n            if (!rsc_1.environment.isMobile)\n                yield (0, topbarFusion_1.unloadTopbarFusion)();\n            (0, docks_1.destroyDockBg)();\n            (0, sidepanels_1.removeIndentGuidesFormatClassName)();\n            (0, afwd_1.removeProtyleSpacings)();\n            (0, docks_1.removeDockbClassName)();\n            (0, protyleStatus_1.removeProtyleStatusClassName)();\n            (0, focusedBlock_1.removeFocusedBlockClass)();\n            (0, env_1.removeEnvClassNames)();\n            (0, scrollbar_1.restoreDefaultSiyuanScrollbar)();\n            (0, trafficLights_1.restoreTrafficLightPosition)();\n            document.body.classList.remove("body-asri--fullscreen", "asri-tfp", "asri-tfp-acrylic", "asri-tfp-progressive", "asri-c-0");\n            (0, asriConfigs_1.unloadThemePalette)();\n            (0, util_1.removeHdrSupportImage)();\n            (0, vibrancy_1.removeVibrancy)();\n        }\n        (0, vibrancy_1.setThemeSource)();\n        document.removeEventListener("mouseup", lowFreqEventsCallback);\n        document.removeEventListener("dragend", lowFreqEventsCallback);\n        document.removeEventListener("keyup", lowFreqEventsCallback, true);\n        window.removeEventListener("focus", winFocusChangeCallback);\n        window.removeEventListener("blur", winFocusChangeCallback);\n        document.removeEventListener("selectionchange", focusedBlock_1.selectionChangeCallback);\n        globalClassNameMo.disconnect();\n        (0, asriConfigs_1.removePaletteMenuItemClick)();\n        (0, asriConfigs_1.removeTfpMenuItemCallback)();\n        if (!rsc_1.environment.isMobile) {\n            lytCenterRo.disconnect();\n            winRo.disconnect();\n        }\n    });\n}\nfunction lowFreqEventsCallback(e) {\n    (0, asriConfigs_1.createBarModeMenuItems)(e);\n    (0, afwd_1.addAfwdMenuItems)(e);\n    updateStyles(e);\n    (0, modeTransition_1.modeTransitionOnClick)(e);\n}\nfunction winFocusChangeCallback(e) {\n    (0, interfaceState_1.updateWndEls)().then(() => {\n        updateStyles();\n        !rsc_1.environment.isIOSApp && asriConfigs_1.followSysAccentColor && rsc_1.environment.supportOklch && (0, asriConfigs_1.getSystemAccentColor)();\n    });\n}\nfunction updateStyles(e) {\n    return __awaiter(this, void 0, void 0, function* () {\n        // run on first load\n        if (!e) {\n            lowFreqStyleUpdates();\n            (0, topbarFusion_1.calcTopbarSpacings)().then(topbarFusion_1.calcTabbarSpacings);\n        }\n        // run on mouse events\n        else if (e.type.startsWith("mouseup") || e.type.startsWith("drag") || (e instanceof KeyboardEvent && (e.key === "Control" || e.key === "Alt" || e.key === "Shift" || e.key === "Meta"))) {\n            lowFreqStyleUpdates();\n            Promise.resolve()\n                .then(() => {\n                (0, topbarFusion_1.recalcDragInitials)();\n                return (0, topbarFusion_1.calcTopbarSpacings)(0, false, interfaceState_1.doesTopBarOverflow);\n            })\n                .then(topbarFusion_1.calcTabbarSpacings);\n        }\n        function lowFreqStyleUpdates() {\n            setTimeout(() => __awaiter(this, void 0, void 0, function* () {\n                (0, docks_1.updateDockLBgAndBorder)();\n                yield (0, interfaceState_1.updateWndEls)();\n                (0, docks_1.addDockbClassName)();\n                !rsc_1.environment.isIOSApp && asriConfigs_1.followSysAccentColor && rsc_1.environment.supportOklch && (0, asriConfigs_1.getSystemAccentColor)();\n            }), 0);\n        }\n    });\n}\nfunction globalClassNameMoCallback(mutationList, observer) {\n    return __awaiter(this, void 0, void 0, function* () {\n        var _a, _b;\n        for (let mutation of mutationList) {\n            const target = mutation.target;\n            if (target.classList.contains("body--blur"))\n                return; // ⚠️ ignore constant classname change when app window blurs which cause unnecessary re-render and high cpu usage.\n            // filetree list item switch\n            if (target.classList.contains("b3-list-item--focus")) {\n                (0, sidepanels_1.debouncedFormatIndentGuidesForFocusedItems)();\n            }\n            // tab switch\n            if (target.classList.contains("item--focus")) {\n                const docId = (_a = target.getAttribute("data-id")) !== null && _a !== void 0 ? _a : undefined;\n                (0, protyleStatus_1.toggleProtyleStatus)(docId);\n                docId && asriConfigs_1.asriConfigs[asriConfigs_1.curMode].followCoverImgColor && (0, coverImgColor_1.updateCoverImgColor)(docId);\n            }\n            if (target.classList.contains("layout__wnd--active")) {\n                const targetDoc = target.querySelector(".layout__center .layout-tab-container>[data-id]:not(.fn__none)");\n                if (!targetDoc)\n                    return;\n                const docId = (_b = targetDoc.getAttribute("data-id")) !== null && _b !== void 0 ? _b : undefined;\n                (0, protyleStatus_1.toggleProtyleStatus)(docId);\n                docId && asriConfigs_1.asriConfigs[asriConfigs_1.curMode].followCoverImgColor && (0, coverImgColor_1.updateCoverImgColor)(docId);\n            }\n        }\n    });\n}\nfunction lytCenterRoCallback(entries, observer) {\n    (0, topbarFusion_1.calcTopbarSpacings)(0, isWinResizing, interfaceState_1.doesTopBarOverflow).then(topbarFusion_1.calcTabbarSpacings);\n}\nfunction winRoCallback(entries, observer) {\n    for (let entry of entries) {\n        isWinResizing = true;\n        debouncedHandleWinResizeEnd();\n        const { inlineSize } = entry.contentBoxSize[0];\n        if (entry.target instanceof HTMLElement) {\n            // check if it\'s the first time to trigger resize event, if so, skip the calculation\n            if (!entry.target.dataset.prevWidth) {\n                entry.target.dataset.prevWidth = inlineSize + "";\n                continue;\n            }\n            // get previous width\n            const prevWidth = parseFloat(entry.target.dataset.prevWidth);\n            const widthChange = inlineSize - prevWidth;\n            entry.target.dataset.prevWidth = inlineSize + "";\n            protyleWidthChange = widthChange;\n        }\n    }\n}\nconst debouncedHandleWinResizeEnd = (0, misc_1.debounce)(() => {\n    isWinResizing = false;\n    (0, topbarFusion_1.handleMacFullScreen)();\n    (0, interfaceState_1.updateTopbarOverflow)();\n    if (!interfaceState_1.doesTopBarOverflow)\n        (0, topbarFusion_1.recalcDragInitials)();\n    (0, topbarFusion_1.calcTopbarSpacings)(protyleWidthChange, isWinResizing, interfaceState_1.doesTopBarOverflow).then(topbarFusion_1.calcTabbarSpacings);\n    protyleWidthChange = 0;\n}, 200);\nfunction appearanceModeUpdateCallback(_e) {\n    (0, modeTransition_1.startFadeInFadeOutTranstition)(600, () => { }, 200);\n}\n\n\n//# sourceURL=webpack://asri/./src/modules/index.ts?')},"./src/modules/modeTransition.ts":function(__unused_webpack_module,exports,__webpack_require__){eval("\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.darkModeMediaQuery = void 0;\nexports.modeTransitionOnClick = modeTransitionOnClick;\nexports.startFadeInFadeOutTranstition = startFadeInFadeOutTranstition;\nconst vibrancy_1 = __webpack_require__(/*! ./vibrancy */ \"./src/modules/vibrancy.ts\");\nfunction modeTransitionOnClick(e) {\n    return __awaiter(this, void 0, void 0, function* () {\n        var _a, _b;\n        if (e.type !== \"mouseup\")\n            return;\n        const target = e.target;\n        if (target.closest('[data-name=\"barmode\"] .b3-menu__item:not([id])')) {\n            console.log(`Clicked item: ${target.textContent}, dataset: ${(_a = target.parentElement) === null || _a === void 0 ? void 0 : _a.dataset.id}`);\n            // e.stopPropagation();\n            // e.preventDefault();\n            startFadeInFadeOutTranstition();\n            if (((_b = target.parentElement) === null || _b === void 0 ? void 0 : _b.dataset.id) === \"themeOS\")\n                (0, vibrancy_1.setThemeSource)();\n        }\n    });\n}\nfunction startFadeInFadeOutTranstition() {\n    return __awaiter(this, arguments, void 0, function* (animDuration = 600, func, waitDuration = 0) {\n        // // Setup view transition support\n        // const meta = document.createElement('meta');\n        // meta.name = 'view-transition';\n        // meta.content = 'same-origin';\n        // document.head.appendChild(meta);\n        if (!document.startViewTransition) {\n            func && func();\n            return;\n        }\n        console.log(\"\\x1b[34m\\x1b[1m\\x1b[47mMode Transition started\\x1b[0m\");\n        if (waitDuration > 0) {\n            const wait = (ms) => {\n                return new Promise((r) => setTimeout(r, ms));\n            };\n            const transition = document.startViewTransition(() => __awaiter(this, void 0, void 0, function* () {\n                yield Promise.race([wait(waitDuration)]);\n                func && func();\n            }));\n            transition.ready.then(() => {\n                document.documentElement.animate({\n                    opacity: [0, 1],\n                }, {\n                    duration: animDuration,\n                    // easing: 'ease-in-out',\n                });\n            });\n        }\n        else {\n            const transition = document.startViewTransition(func);\n            const style = document.createElement(\"style\");\n            style.textContent = `\n            ::view-transition-old(root),\n            ::view-transition-new(root) {\n                animation-duration: ${animDuration}ms;\n            }\n        `;\n            document.head.appendChild(style);\n            yield transition.finished;\n            style.remove();\n        }\n    });\n}\nexports.darkModeMediaQuery = window.matchMedia(\"(prefers-color-scheme: dark)\");\n// 圆形过渡\n// let lastClick: any;\n// // addEventListener('click', event => (lastClick = event));\n// function spaNavigate() {\n//     // Fallback for browsers that don't support this API:\n//     if (!document.startViewTransition) {\n//         return;\n//     }\n//     // Get the click position, or fallback to the middle of the screen\n//     const x = lastClick?.clientX ?? innerWidth / 2;\n//     const y = lastClick?.clientY ?? innerHeight / 2;\n//     // Get the distance to the furthest corner\n//     const endRadius = Math.hypot(\n//         Math.max(x, innerWidth - x),\n//         Math.max(y, innerHeight - y)\n//     );\n//     // With a transition:\n//     const transition = document.startViewTransition(() => {\n//     });\n//     // Wait for the pseudo-elements to be created:\n//     transition.ready.then(() => {\n//         // Animate the root's new view\n//         document.documentElement.animate(\n//             {\n//                 clipPath: [\n//                     `circle(0 at ${x}px ${y}px)`,\n//                     `circle(${endRadius}px at ${x}px ${y}px)`,\n//                 ],\n//             },\n//             {\n//                 duration: 500,\n//                 easing: 'ease-in',\n//                 // Specify which pseudo-element to animate\n//                 pseudoElement: '::view-transition-new(root)',\n//             }\n//         );\n//     });\n// }\n\n\n//# sourceURL=webpack://asri/./src/modules/modeTransition.ts?")},"./src/modules/protyleStatus.ts":function(__unused_webpack_module,exports,__webpack_require__){eval('\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.toggleProtyleStatus = toggleProtyleStatus;\nexports.removeProtyleStatusClassName = removeProtyleStatusClassName;\nconst misc_1 = __webpack_require__(/*! ../util/misc */ "./src/util/misc.ts");\nconst rsc_1 = __webpack_require__(/*! ../util/rsc */ "./src/util/rsc.ts");\nfunction toggleProtyleStatus(docID) {\n    return __awaiter(this, void 0, void 0, function* () {\n        let isprotyle = (yield (0, misc_1.getFocusedProtyleInfo)(docID)).isProtyle;\n        const status = rsc_1.asriDoms.status || (yield (0, misc_1.querySelectorAsync)("#status"));\n        if (!status)\n            return;\n        status.classList.toggle("asri--non-protyle-status", !isprotyle);\n    });\n}\nfunction removeProtyleStatusClassName() {\n    const status = rsc_1.asriDoms.status;\n    if (!status)\n        return;\n    status.classList.remove("asri--non-protyle-status");\n}\n\n\n//# sourceURL=webpack://asri/./src/modules/protyleStatus.ts?')},"./src/modules/scrollbar.ts":function(__unused_webpack_module,exports,__webpack_require__){eval('\n/**\n * @description This module is used to support Safari.\n */\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.useMacSysScrollbar = useMacSysScrollbar;\nexports.restoreDefaultSiyuanScrollbar = restoreDefaultSiyuanScrollbar;\nconst rsc_1 = __webpack_require__(/*! ../util/rsc */ "./src/util/rsc.ts");\nconst { isMacOS, isMobile } = rsc_1.environment;\nconst asriDeletedRules = [];\n/**\n * Can be achieved by `scrollbar` css property.\n * This module is used to support Safari.\n */\nfunction useMacSysScrollbar() {\n    return __awaiter(this, void 0, void 0, function* () {\n        if (isMacOS || isMobile) {\n            for (let i = 0; i < document.styleSheets.length; i++) {\n                let styleSheet = document.styleSheets[i];\n                try {\n                    for (let j = 0; j < styleSheet.cssRules.length; j++) {\n                        let rule = styleSheet.cssRules[j];\n                        if (rule.selectorText && rule.selectorText.includes("::-webkit-scrollbar")) {\n                            if (rule.style.width || rule.style.height || rule.style.backgroundColor) {\n                                asriDeletedRules.push({ styleSheet: styleSheet, rule: rule.cssText });\n                                styleSheet.deleteRule(j);\n                                j--;\n                            }\n                        }\n                    }\n                }\n                catch (e) {\n                    console.log(e);\n                }\n            }\n        }\n    });\n}\nfunction restoreDefaultSiyuanScrollbar() {\n    return __awaiter(this, void 0, void 0, function* () {\n        if (asriDeletedRules) {\n            for (let i = 0; i < asriDeletedRules.length; i++) {\n                let rule = asriDeletedRules[i];\n                rule.styleSheet.insertRule(rule.rule, rule.styleSheet.cssRules.length);\n            }\n        }\n    });\n}\n\n\n//# sourceURL=webpack://asri/./src/modules/scrollbar.ts?')},"./src/modules/sidepanels.ts":function(__unused_webpack_module,exports,__webpack_require__){eval('\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.debouncedFormatIndentGuidesForFocusedItems = void 0;\nexports.formatIndentGuidesForFocusedItems = formatIndentGuidesForFocusedItems;\nexports.removeIndentGuidesFormatClassName = removeIndentGuidesFormatClassName;\nconst misc_1 = __webpack_require__(/*! ../util/misc */ "./src/util/misc.ts");\nconst rsc_1 = __webpack_require__(/*! ../util/rsc */ "./src/util/rsc.ts");\nconst { isMobile } = rsc_1.environment;\nexports.debouncedFormatIndentGuidesForFocusedItems = (0, misc_1.debounce)(formatIndentGuidesForFocusedItems);\nfunction formatIndentGuidesForFocusedItems() {\n    return __awaiter(this, void 0, void 0, function* () {\n        if (isMobile)\n            return;\n        if (!rsc_1.asriDoms.layoutDockL)\n            yield (0, misc_1.querySelectorAsync)(".layout__dockl");\n        let listItemsFocus = document.querySelectorAll(".file-tree .b3-list-item--focus");\n        if (!listItemsFocus.length)\n            return;\n        document.querySelectorAll(".file-tree .has-focus").forEach((oldUl) => oldUl.classList.remove("has-focus"));\n        listItemsFocus.forEach((li) => {\n            if (!li.nextElementSibling || li.nextElementSibling.tagName !== "UL" || li.nextElementSibling.classList.contains("fn__none")) {\n                if (li.parentNode instanceof Element) {\n                    li.parentNode.classList.add("has-focus");\n                }\n            }\n        });\n    });\n}\nfunction removeIndentGuidesFormatClassName() {\n    document.querySelectorAll(".file-tree .has-focus").forEach((el) => el.classList.remove("has-focus"));\n}\n\n\n//# sourceURL=webpack://asri/./src/modules/sidepanels.ts?')},"./src/modules/topbarFusion.ts":function(__unused_webpack_module,exports,__webpack_require__){eval('\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.updateDragRect = updateDragRect;\nexports.handleMacFullScreen = handleMacFullScreen;\nexports.calcTopbarSpacings = calcTopbarSpacings;\nexports.calcTabbarSpacings = calcTabbarSpacings;\nexports.unloadTopbarFusion = unloadTopbarFusion;\nexports.createTopbarFusionElements = createTopbarFusionElements;\nexports.recalcDragInitials = recalcDragInitials;\nconst misc_1 = __webpack_require__(/*! ../util/misc */ "./src/util/misc.ts");\nconst rsc_1 = __webpack_require__(/*! ../util/rsc */ "./src/util/rsc.ts");\nconst interfaceState_1 = __webpack_require__(/*! ../util/interfaceState */ "./src/util/interfaceState.ts");\n// added toolbar elements\nlet pluginsDivider, leftSpacing, rightSpacing;\nlet topbar = rsc_1.asriDoms.toolbar;\nlet topbarRect, dragRect, layoutsCenterRect, leftSpacingRect, rightSpacingRect, barForwardRect, barSyncRect;\nlet dragRectInitialLeft, dragRectInitialRight;\nlet fromFullscreen = false;\nfunction updateDragRect() {\n    return __awaiter(this, arguments, void 0, function* (mode = "rect", ...dir) {\n        const drag = rsc_1.asriDoms.drag || (yield (0, misc_1.querySelectorAsync)("#drag"));\n        if (!drag || rsc_1.environment.isMiniWindow) {\n            return -1;\n        }\n        return new Promise((resolve) => {\n            if (mode === "initials") {\n                if (!dir.length || dir.includes("L")) {\n                    dragRectInitialLeft = drag.getBoundingClientRect().left;\n                    resolve(dragRectInitialLeft);\n                    // console.log(\'dragRectInitialLeft\', dragRectInitialLeft)\n                }\n                if (!dir.length || dir.includes("R")) {\n                    dragRectInitialRight = drag.getBoundingClientRect().right;\n                    resolve(dragRectInitialRight);\n                    // console.log(\'dragRectInitialRight\', dragRectInitialRight)\n                }\n            }\n            else {\n                dragRect = drag.getBoundingClientRect();\n                resolve(dragRect);\n            }\n        });\n    });\n}\nfunction handleMacFullScreen() {\n    return __awaiter(this, void 0, void 0, function* () {\n        if (!rsc_1.environment.isMacOS)\n            return;\n        if ((0, interfaceState_1.isFullScreen)()) {\n            document.body.classList.add("body-asri--fullscreen");\n            dragRectInitialLeft -= fromFullscreen ? 0 : 80 + 8;\n            // dragRectInitialRight += protyleWidthChange;\n            fromFullscreen = true;\n        }\n        else {\n            document.body.classList.remove("body-asri--fullscreen");\n            leftSpacing === null || leftSpacing === void 0 ? void 0 : leftSpacing.style.setProperty("width", "0px");\n            dragRectInitialLeft = (yield updateDragRect("initials", "L"));\n            // dragRectInitialRight -= protyleWidthChange;\n            leftSpacing === null || leftSpacing === void 0 ? void 0 : leftSpacing.style.removeProperty("width");\n            fromFullscreen = false;\n        }\n    });\n}\nfunction calcTopbarSpacings() {\n    return __awaiter(this, arguments, void 0, function* (widthChange = 0, isWinResizing = false, doesTopBarOverflow = false) {\n        if (rsc_1.environment.isMiniWindow || rsc_1.environment.isMobile) {\n            return {\n                execute: false,\n                centerRectRight: 0,\n            };\n        }\n        let layoutsCenter = rsc_1.asriDoms.layoutCenter || (yield (0, misc_1.querySelectorAsync)(".layout__center"));\n        // calcAndApply();\n        // if (!isWinResizing) calcAndApply(); // otherwise would cause dragRightInitial to be at unexpected position\n        // else dragRectRightInitial = dragRectRightInitial + widthChange;\n        return new Promise((resolve) => __awaiter(this, void 0, void 0, function* () {\n            var _a, _b, _c, _d, _e, _f;\n            if (isWinResizing)\n                dragRectInitialRight += widthChange;\n            if (!dragRectInitialLeft || !dragRectInitialRight)\n                yield updateDragRect("initials");\n            layoutsCenterRect = layoutsCenter.getBoundingClientRect();\n            barSyncRect = rsc_1.asriDoms.barSync.getBoundingClientRect();\n            barForwardRect = rsc_1.asriDoms.barForward.getBoundingClientRect();\n            let centerRectLeft = layoutsCenterRect.left, centerRectRight = layoutsCenterRect.right, barSearchRectLeft = rsc_1.asriDoms.barSearch.getBoundingClientRect().left;\n            // console.log(\'measure: topbar spacings\')\n            if (!isWinResizing) {\n                // left side\n                if (centerRectLeft > dragRectInitialLeft + 8) {\n                    topbar === null || topbar === void 0 ? void 0 : topbar.style.setProperty("--topbar-left-spacing", "0");\n                    // dragRectInitialLeft = fromFullscreen ? dragRectLeftInitial : asriDoms.drag.getBoundingClientRect().left;\n                    if (!(rsc_1.environment.isMacOS && fromFullscreen)) {\n                        yield updateDragRect("initials", "L");\n                    }\n                    // recalc initial everytime\n                    leftSpacing === null || leftSpacing === void 0 ? void 0 : leftSpacing.classList.remove("asri-expanded");\n                }\n                else if (rsc_1.environment.isMacOS && !rsc_1.environment.isInBrowser) {\n                    topbar.style.setProperty("--topbar-left-spacing", centerRectLeft - barSyncRect.right + 4 + "px");\n                    leftSpacing === null || leftSpacing === void 0 ? void 0 : leftSpacing.classList.add("asri-expanded");\n                }\n                else {\n                    topbar.style.setProperty("--topbar-left-spacing", centerRectLeft - barForwardRect.right + 4 + "px");\n                    leftSpacing === null || leftSpacing === void 0 ? void 0 : leftSpacing.classList.add("asri-expanded");\n                }\n                // right side\n                if (centerRectRight < dragRectInitialRight - 8 && !doesTopBarOverflow) {\n                    topbar.style.setProperty("--topbar-right-spacing", "0");\n                    yield updateDragRect("initials", "R");\n                    // css related\n                    (_a = rsc_1.asriDoms.dockR) === null || _a === void 0 ? void 0 : _a.style.removeProperty("--avoid-topbar");\n                    (_b = rsc_1.asriDoms.layoutDockR) === null || _b === void 0 ? void 0 : _b.style.removeProperty("--avoid-topbar");\n                }\n                else {\n                    if (rsc_1.environment.isMacOS || rsc_1.environment.isInBrowser) {\n                        topbar.style.setProperty("--topbar-right-spacing", window.innerWidth - centerRectRight + 1 + "px");\n                        // windowControls element takes up 2px\n                        (_c = rsc_1.asriDoms.dockR) === null || _c === void 0 ? void 0 : _c.style.setProperty("--avoid-topbar", "4px");\n                        (_d = rsc_1.asriDoms.layoutDockR) === null || _d === void 0 ? void 0 : _d.style.setProperty("--avoid-topbar", "4px");\n                    }\n                    else {\n                        topbar.style.setProperty("--topbar-right-spacing", barSearchRectLeft - centerRectRight + 6 + "px");\n                        (_e = rsc_1.asriDoms.dockR) === null || _e === void 0 ? void 0 : _e.style.setProperty("--avoid-topbar", "calc(var(--toolbar-height) - 6px)");\n                        (_f = rsc_1.asriDoms.layoutDockR) === null || _f === void 0 ? void 0 : _f.style.setProperty("--avoid-topbar", "calc(var(--toolbar-height) - 6px)");\n                    }\n                }\n            }\n            resolve({\n                execute: true,\n                centerRectRight: centerRectRight,\n            });\n        }));\n    });\n}\n/**\n * calculates tabbar spacings & positions, always comes after topbar spacings calculation\n */\nfunction calcTabbarSpacings() {\n    return __awaiter(this, arguments, void 0, function* ({ execute, centerRectRight } = { execute: false, centerRectRight: 0 }) {\n        var _a, _b;\n        // console.log(\'tabbar spacings\')\n        if (!execute)\n            return;\n        topbarRect = (_a = rsc_1.asriDoms.toolbar) === null || _a === void 0 ? void 0 : _a.getBoundingClientRect();\n        (yield updateDragRect("rect"));\n        layoutsCenterRect = (_b = rsc_1.asriDoms.layoutCenter) === null || _b === void 0 ? void 0 : _b.getBoundingClientRect();\n        // set divider style\n        (() => {\n            // console.log(\'pluginsDivider\', pluginsDivider)\n            if (!pluginsDivider && !(pluginsDivider = document.getElementById("AsriPluginsIconsDivider")))\n                return;\n            if (centerRectRight < dragRectInitialRight - 8) {\n                // horisontal divider\n                pluginsDivider.style.setProperty("--container-bg", "var(--b3-border-color-trans))");\n                pluginsDivider.style.left = centerRectRight + "px";\n                pluginsDivider.style.right = "0";\n                pluginsDivider.style.removeProperty("height");\n                pluginsDivider.style.removeProperty("top");\n                pluginsDivider.style.removeProperty("width");\n            }\n            else {\n                // vertical divider\n                // if (!dragRect) await updateDragRect(\'rect\') as DOMRect;\n                // const dragRect = doms.drag?.getBoundingClientRect() as DOMRect;\n                pluginsDivider.style.setProperty("--container-bg", "var(--b3-border-color-trans)");\n                pluginsDivider.style.left = dragRect.right - 10 + "px";\n                pluginsDivider.style.width = "2px";\n                pluginsDivider.style.height = "21px";\n                pluginsDivider.style.top = "13.5px";\n            }\n        })();\n        // console.log("center right:", centerRectRight, \'drag initial right\', dragRectInitialRight, \'dragrect right:\', dragRect?.right)\n        interfaceState_1.wndElements === null || interfaceState_1.wndElements === void 0 ? void 0 : interfaceState_1.wndElements.forEach((wnd) => __awaiter(this, void 0, void 0, function* () {\n            let tabbarContainer = wnd.querySelector(\'.fn__flex-column[data-type="wnd"] > .fn__flex:first-child\');\n            let tabbarContainerRect;\n            // console.log(tabbarContainer);\n            if (tabbarContainer.classList.contains("fn__none")) {\n                // fix https://github.com/mustakshif/Asri/issues/117\n                tabbarContainer = (yield (0, misc_1.querySelectorAsync)(\'.fn__flex-column[data-type="wnd"] > .fn__flex:first-child:not(.fn__none)\', wnd, 3));\n            }\n            tabbarContainerRect = tabbarContainer === null || tabbarContainer === void 0 ? void 0 : tabbarContainer.getBoundingClientRect();\n            if (!tabbarContainerRect)\n                return;\n            let paddingLeftValue = tabbarContainerRect.left < dragRect.left ? dragRect.left - tabbarContainerRect.left - 4 : 0;\n            let paddingRightValue = tabbarContainerRect.right > dragRect.right ? tabbarContainerRect.right - dragRect.right + 8 : 0;\n            // console.log(\'measure: tabbar spacings inner\')\n            if ((0, misc_1.isOverlapping)(tabbarContainer, rsc_1.asriDoms.drag) || (0, misc_1.isOverlapping)(tabbarContainer, rsc_1.asriDoms.toolbar)) {\n                tabbarContainer.style.paddingLeft = paddingLeftValue + "px";\n                tabbarContainer.style.paddingRight = paddingRightValue + "px";\n                // asriDoms.drag = document.getElementById(\'drag\');\n                // add top padding in extremely narrow width\n                if ((tabbarContainerRect.right - paddingRightValue - 240 < dragRect.left && tabbarContainerRect.left < dragRect.left) || (tabbarContainerRect.left + paddingLeftValue + 240 > dragRect.right && tabbarContainerRect.right > dragRect.right)) {\n                    tabbarContainer.style.paddingTop = "42px";\n                    tabbarContainer.style.paddingLeft = "0";\n                    tabbarContainer.style.paddingRight = "0";\n                }\n                else {\n                    tabbarContainer.style.removeProperty("padding-top");\n                }\n            }\n            else {\n                tabbarContainer.style.removeProperty("padding-left");\n                tabbarContainer.style.removeProperty("padding-right");\n                tabbarContainer.style.removeProperty("padding-top");\n            }\n        }));\n    });\n}\nfunction unloadTopbarFusion() {\n    return __awaiter(this, void 0, void 0, function* () {\n        var _a, _b;\n        yield (0, interfaceState_1.updateWndEls)();\n        removeTopbarElements();\n        interfaceState_1.wndElements === null || interfaceState_1.wndElements === void 0 ? void 0 : interfaceState_1.wndElements.forEach((wnd) => {\n            let tabbarContainer = wnd.firstElementChild;\n            tabbarContainer.style.removeProperty("padding-top");\n            tabbarContainer.style.removeProperty("padding-left");\n            tabbarContainer.style.removeProperty("padding-right");\n        });\n        rsc_1.asriDoms.layoutCenter.dataset.prevWidth = undefined;\n        document.body.dataset.prevWidth = undefined;\n        (_a = rsc_1.asriDoms.dockR) === null || _a === void 0 ? void 0 : _a.style.removeProperty("--avoid-topbar");\n        (_b = rsc_1.asriDoms.layoutDockR) === null || _b === void 0 ? void 0 : _b.style.removeProperty("--avoid-topbar");\n    });\n}\nfunction createTopbarFusionElements() {\n    if (rsc_1.environment.isMobile)\n        return;\n    pluginsDivider = createTopbarElementById("AsriPluginsIconsDivider", undefined, rsc_1.asriDoms.drag);\n    leftSpacing = rsc_1.environment.isMacOS && !rsc_1.environment.isInBrowser ? createTopbarElementById("AsriTopbarLeftSpacing", undefined, rsc_1.asriDoms.barSync) : createTopbarElementById("AsriTopbarLeftSpacing", undefined, rsc_1.asriDoms.barForward);\n    rightSpacing = rsc_1.environment.isMacOS || rsc_1.environment.isInBrowser ? createTopbarElementById("AsriTopbarRightSpacing") : createTopbarElementById("AsriTopbarRightSpacing", rsc_1.asriDoms.barSearch);\n    // add svg to toolbar elements to fix barMore menu issue\n    const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");\n    rightSpacing === null || rightSpacing === void 0 ? void 0 : rightSpacing.appendChild(svg.cloneNode(true));\n    pluginsDivider === null || pluginsDivider === void 0 ? void 0 : pluginsDivider.appendChild(svg.cloneNode(true));\n    leftSpacing === null || leftSpacing === void 0 ? void 0 : leftSpacing.appendChild(svg.cloneNode(true));\n}\nfunction createTopbarElementById(newId, before = undefined, after = undefined) {\n    if (document.getElementById(newId))\n        return;\n    if (!rsc_1.asriDoms.toolbar)\n        return;\n    let newDiv = document.createElement("div");\n    newDiv.id = newId;\n    if (before) {\n        rsc_1.asriDoms.toolbar.insertBefore(newDiv, before);\n    }\n    else if (after) {\n        rsc_1.asriDoms.toolbar.insertBefore(newDiv, after.nextSibling);\n    }\n    else {\n        rsc_1.asriDoms.toolbar.appendChild(newDiv);\n    }\n    return newDiv;\n}\nfunction recalcDragInitials() {\n    return __awaiter(this, void 0, void 0, function* () {\n        if (!leftSpacing || !rightSpacing)\n            return;\n        leftSpacing.style.setProperty("width", "0px");\n        rightSpacing.style.setProperty("width", "0px");\n        yield updateDragRect("initials");\n        leftSpacing.style.removeProperty("width");\n        rightSpacing.style.removeProperty("width");\n        // console.log(\'recalcDragInitials\', dragRectInitialLeft, dragRectInitialRight)\n    });\n}\nfunction removeTopbarElements() {\n    if (pluginsDivider) {\n        pluginsDivider.remove();\n        // pluginsDivider = undefined;\n    }\n    if (leftSpacing) {\n        leftSpacing.remove();\n        leftSpacing = undefined;\n    }\n    if (rightSpacing) {\n        rightSpacing.remove();\n        rightSpacing = undefined;\n    }\n}\n\n\n//# sourceURL=webpack://asri/./src/modules/topbarFusion.ts?')},"./src/modules/trafficLights.ts":(__unused_webpack_module,exports,__webpack_require__)=>{eval('\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.applyTrafficLightPosition = applyTrafficLightPosition;\nexports.restoreTrafficLightPosition = restoreTrafficLightPosition;\nconst electron_1 = __webpack_require__(/*! ../util/electron */ "./src/util/electron.ts");\nconst rsc_1 = __webpack_require__(/*! ../util/rsc */ "./src/util/rsc.ts");\nfunction setTrafficLightPosition(x, y = x) {\n    if (electron_1.remote) {\n        electron_1.remote.getCurrentWindow().setWindowButtonPosition({ x: x, y: y });\n    }\n}\nfunction applyTrafficLightPosition() {\n    if (rsc_1.environment.isMacOS) {\n        if (!rsc_1.environment.isInBrowser)\n            setTrafficLightPosition(16);\n        if (rsc_1.environment.isMiniWindow)\n            setTrafficLightPosition(14);\n    }\n}\nfunction restoreTrafficLightPosition() {\n    if (rsc_1.environment.isMacOS) {\n        if (!rsc_1.environment.isInBrowser)\n            setTrafficLightPosition(8);\n        if (rsc_1.environment.isMiniWindow)\n            setTrafficLightPosition(8, 13);\n    }\n}\n\n\n//# sourceURL=webpack://asri/./src/modules/trafficLights.ts?')},"./src/modules/vibrancy.ts":(__unused_webpack_module,exports,__webpack_require__)=>{eval('\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.setVibrancy = setVibrancy;\nexports.removeVibrancy = removeVibrancy;\nexports.setThemeSource = setThemeSource;\nconst rsc_1 = __webpack_require__(/*! ../util/rsc */ "./src/util/rsc.ts");\nconst electron_1 = __webpack_require__(/*! ../util/electron */ "./src/util/electron.ts");\nconst { nativeTheme } = electron_1.remote !== null && electron_1.remote !== void 0 ? electron_1.remote : {};\n// const isSysDark = nativeTheme.shouldUseDarkColors;\nconst appMode = rsc_1.environment.appSchemeMode;\nconst isFollowSysMode = rsc_1.environment.isFollowSysMode;\nconst os = electron_1.remote === null || electron_1.remote === void 0 ? void 0 : electron_1.remote.require("os");\nconst release = os === null || os === void 0 ? void 0 : os.release();\nconst buildVer = parseInt((release === null || release === void 0 ? void 0 : release.split(".")[2]) || "0");\nconst isWin11 = buildVer >= 22000;\nfunction setVibrancy() {\n    if (!electron_1.remote)\n        return;\n    setThemeSource(isFollowSysMode ? "system" : appMode);\n    if (rsc_1.environment.isMacOS) {\n        electron_1.remote.getCurrentWindow().setVibrancy("menu", 300);\n        document.body.classList.add("asri-vibrancy");\n    }\n    else if (rsc_1.environment.isWindows && isWin11) {\n        electron_1.remote.getCurrentWindow().setBackgroundMaterial("acrylic", 300);\n        document.body.classList.add("asri-vibrancy");\n    }\n}\nfunction removeVibrancy() {\n    if (!electron_1.remote)\n        return;\n    setThemeSource();\n    if (rsc_1.environment.isMacOS) {\n        electron_1.remote.getCurrentWindow().setVibrancy(null);\n    }\n    else if (rsc_1.environment.isWindows && isWin11) {\n        electron_1.remote.getCurrentWindow().setBackgroundMaterial(null);\n    }\n    document.body.classList.remove("asri-vibrancy");\n}\nfunction setThemeSource(mode = "system") {\n    if (electron_1.remote && (rsc_1.environment.isMacOS || rsc_1.environment.isWindows && isWin11)) {\n        setTimeout(() => {\n            nativeTheme.themeSource = mode; // can break theme.js execution\n        }, 400);\n    }\n}\n\n\n//# sourceURL=webpack://asri/./src/modules/vibrancy.ts?')},"./src/util/api.ts":function(__unused_webpack_module,exports){eval('\n// 思源 API\n// [cc-baselib/siYuanApi.js at main · leolee9086/cc-baselib](https://github.com/leolee9086/cc-baselib/blob/main/src/siYuanApi.js)\n// Rem Craft/util/api.js\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.getFile = getFile;\nexports.putFile = putFile;\nexports.setBlockAttrs = setBlockAttrs;\nexports.getBlockAttrs = getBlockAttrs;\nfunction getFile(path) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const response = yield fetch("/api/file/getFile", {\n            method: "POST",\n            // https://github.com/siyuan-note/siyuan/issues/14571\n            // headers: {\n            //     Authorization: `Token \'\'`,\n            // },\n            body: JSON.stringify({\n                path: path,\n            }),\n        });\n        if (response.ok)\n            return response;\n        else\n            return null;\n    });\n}\nfunction putFile(path_1, filedata_1) {\n    return __awaiter(this, arguments, void 0, function* (path, filedata, isDir = false, modTime = Date.now()) {\n        let blob = new Blob([filedata]);\n        let fileName = path.split("/").pop();\n        let file = new File([blob], fileName);\n        let formdata = new FormData();\n        formdata.append("path", path);\n        formdata.append("file", file);\n        formdata.append("isDir", String(isDir));\n        formdata.append("modTime", String(modTime));\n        const response = yield fetch("/api/file/putFile", {\n            body: formdata,\n            method: "POST",\n            //https://github.com/siyuan-note/siyuan/issues/14571\n            // headers: {\n            //     Authorization: `Token \'\'`,\n            // },\n        });\n        if (response.ok)\n            return yield response.json();\n        else\n            return null;\n    });\n}\nfunction setBlockAttrs(blockId, attrObj) {\n    return __awaiter(this, void 0, void 0, function* () {\n        let url = "/api/attr/setBlockAttrs";\n        // console.log(url, blockId, attrObj)\n        return resolveResponse(requestFromSiyuan(url, {\n            "id": blockId,\n            "attrs": attrObj,\n        }));\n    });\n}\nfunction getBlockAttrs(id) {\n    return __awaiter(this, void 0, void 0, function* () {\n        let url = "/api/attr/getBlockAttrs";\n        return resolveResponse(requestFromSiyuan(url, {\n            "id": id,\n        }));\n    });\n}\nfunction resolveResponse(response) {\n    return __awaiter(this, void 0, void 0, function* () {\n        let r = yield response;\n        // console.log(r)\n        return r["code"] === 0 ? r["data"] : null;\n    });\n}\nfunction requestFromSiyuan(url, data) {\n    return __awaiter(this, void 0, void 0, function* () {\n        let resData = null;\n        yield fetch(url, {\n            "body": JSON.stringify(data),\n            "method": "POST",\n            "headers": {\n                "Authorization": `Token ${""}`,\n            },\n        }).then(function (response) {\n            resData = response.json();\n        });\n        return resData;\n    });\n}\n\n\n//# sourceURL=webpack://asri/./src/util/api.ts?')},"./src/util/colorTools.ts":(__unused_webpack_module,exports)=>{eval('\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.extractFirstColorFromCSSBackground = extractFirstColorFromCSSBackground;\nexports.convertToHex = convertToHex;\nexports.hexToHSL = hexToHSL;\nexports.hexToOklch = hexToOklch;\n/**\n * 从CSS background-image属性中提取第一个颜色并转换为hex格式\n * @param cssBackgroundImage CSS background-image属性值\n * @returns 第一个找到的颜色的hex值，如果没有找到则返回null\n */\nfunction extractFirstColorFromCSSBackground(cssBackgroundImage) {\n    if (!cssBackgroundImage)\n        return null;\n    // 颜色匹配的正则表达式模式\n    const colorPatterns = [\n        // hex颜色: #fff, #ffffff, #fffa, #ffffffff\n        /#([0-9a-fA-F]{3,8})\\b/,\n        // rgb/rgba颜色: rgb(255,255,255), rgba(255,255,255,0.5)\n        /rgba?\\(\\s*(\\d+(?:\\.\\d+)?)\\s*,\\s*(\\d+(?:\\.\\d+)?)\\s*,\\s*(\\d+(?:\\.\\d+)?)\\s*(?:,\\s*(\\d+(?:\\.\\d+)?))?\\s*\\)/,\n        // hsl/hsla颜色: hsl(0,100%,50%), hsla(0,100%,50%,0.5)\n        /hsla?\\(\\s*(\\d+(?:\\.\\d+)?)\\s*,\\s*(\\d+(?:\\.\\d+)?)%\\s*,\\s*(\\d+(?:\\.\\d+)?)%\\s*(?:,\\s*(\\d+(?:\\.\\d+)?))?\\s*\\)/,\n        // CSS颜色名称\n        /\\b(black|white|red|green|blue|yellow|orange|purple|pink|brown|gray|grey|transparent)\\b/i,\n    ];\n    // 按顺序尝试匹配每种颜色格式\n    for (const pattern of colorPatterns) {\n        const match = cssBackgroundImage.match(pattern);\n        if (match) {\n            return convertToHex(match[0]);\n        }\n    }\n    return null;\n}\n/**\n * 将各种颜色格式转换为hex格式\n * @param colorStr 颜色字符串\n * @returns hex颜色值\n */\nfunction convertToHex(colorStr) {\n    // 如果已经是hex格式，直接返回（补全格式）\n    if (colorStr.startsWith("#")) {\n        return normalizeHex(colorStr);\n    }\n    // 处理rgb/rgba格式\n    const rgbMatch = colorStr.match(/rgba?\\(\\s*(\\d+(?:\\.\\d+)?)\\s*,\\s*(\\d+(?:\\.\\d+)?)\\s*,\\s*(\\d+(?:\\.\\d+)?)\\s*(?:,\\s*(\\d+(?:\\.\\d+)?))?\\s*\\)/);\n    if (rgbMatch) {\n        const r = Math.round(parseFloat(rgbMatch[1]));\n        const g = Math.round(parseFloat(rgbMatch[2]));\n        const b = Math.round(parseFloat(rgbMatch[3]));\n        return rgbToHex(r, g, b);\n    }\n    // 处理hsl/hsla格式\n    const hslMatch = colorStr.match(/hsla?\\(\\s*(\\d+(?:\\.\\d+)?)\\s*,\\s*(\\d+(?:\\.\\d+)?)%\\s*,\\s*(\\d+(?:\\.\\d+)?)%\\s*(?:,\\s*(\\d+(?:\\.\\d+)?))?\\s*\\)/);\n    if (hslMatch) {\n        const h = parseFloat(hslMatch[1]);\n        const s = parseFloat(hslMatch[2]) / 100;\n        const l = parseFloat(hslMatch[3]) / 100;\n        return hslToHex(h, s, l);\n    }\n    // 处理CSS颜色名称\n    const colorNames = {\n        "black": "#000000",\n        "white": "#ffffff",\n        "red": "#ff0000",\n        "green": "#008000",\n        "blue": "#0000ff",\n        "yellow": "#ffff00",\n        "orange": "#ffa500",\n        "purple": "#800080",\n        "pink": "#ffc0cb",\n        "brown": "#a52a2a",\n        "gray": "#808080",\n        "grey": "#808080",\n        "transparent": "#00000000",\n    };\n    const lowerColor = colorStr.toLowerCase();\n    if (colorNames[lowerColor]) {\n        return colorNames[lowerColor];\n    }\n    // 如果无法识别，返回默认颜色\n    return "#000000";\n}\n/**\n * 标准化hex颜色格式\n * @param hex hex颜色字符串\n * @returns 标准化的hex颜色\n */\nfunction normalizeHex(hex) {\n    // 移除#号\n    hex = hex.slice(1);\n    // 3位转6位\n    if (hex.length === 3) {\n        hex = hex\n            .split("")\n            .map((c) => c + c)\n            .join("");\n    }\n    // 4位转8位 (带alpha)\n    if (hex.length === 4) {\n        hex = hex\n            .split("")\n            .map((c) => c + c)\n            .join("");\n    }\n    // 确保是6位或8位\n    if (hex.length === 6 || hex.length === 8) {\n        return "#" + hex.toLowerCase();\n    }\n    // 如果格式不正确，返回黑色\n    return "#000000";\n}\n/**\n * RGB转Hex\n * @param r 红色值 (0-255)\n * @param g 绿色值 (0-255)\n * @param b 蓝色值 (0-255)\n * @returns hex颜色值\n */\nfunction rgbToHex(r, g, b) {\n    const toHex = (n) => {\n        const hex = Math.max(0, Math.min(255, Math.round(n))).toString(16);\n        return hex.length === 1 ? "0" + hex : hex;\n    };\n    return `#${toHex(r)}${toHex(g)}${toHex(b)}`;\n}\n/**\n * HSL转Hex\n * @param h 色相 (0-360)\n * @param s 饱和度 (0-1)\n * @param l 亮度 (0-1)\n * @returns hex颜色值\n */\nfunction hslToHex(h, s, l) {\n    const c = (1 - Math.abs(2 * l - 1)) * s;\n    const x = c * (1 - Math.abs(((h / 60) % 2) - 1));\n    const m = l - c / 2;\n    let r = 0, g = 0, b = 0;\n    if (0 <= h && h < 60) {\n        r = c;\n        g = x;\n        b = 0;\n    }\n    else if (60 <= h && h < 120) {\n        r = x;\n        g = c;\n        b = 0;\n    }\n    else if (120 <= h && h < 180) {\n        r = 0;\n        g = c;\n        b = x;\n    }\n    else if (180 <= h && h < 240) {\n        r = 0;\n        g = x;\n        b = c;\n    }\n    else if (240 <= h && h < 300) {\n        r = x;\n        g = 0;\n        b = c;\n    }\n    else if (300 <= h && h < 360) {\n        r = c;\n        g = 0;\n        b = x;\n    }\n    r = Math.round((r + m) * 255);\n    g = Math.round((g + m) * 255);\n    b = Math.round((b + m) * 255);\n    return rgbToHex(r, g, b);\n}\n// 使用示例和测试\n// function testColorExtraction() {\n//   const testCases = [\n//     "linear-gradient(45deg, #dca 12%, transparent 0, transparent 88%, #dca 0),linear-gradient(135deg, transparent 37%, #a85 0, #a85 63%, transparent 0),linear-gradient(45deg, transparent 37%, #dca 0, #dca 63%, transparent 0) #753",\n//     "linear-gradient(90deg, rgba(200,0,0,.5) 50%, transparent 50%),linear-gradient(rgba(200,0,0,.5) 50%, transparent 50%)",\n//     "radial-gradient(black 3px, transparent 4px),radial-gradient(black 3px, transparent 4px),linear-gradient(#fff 4px, transparent 0)",\n//     "linear-gradient(45deg, transparent 74px, transparent 75px, #a4a4a4 75px, #a4a4a4 76px, transparent 77px, transparent 109px)",\n//     "background: linear-gradient(to right, hsl(240, 100%, 50%), white)",\n//     "background-image: radial-gradient(circle, rgb(255, 0, 0) 0%, blue 100%)",\n//   ];\n//   console.log("颜色提取测试结果:");\n//   testCases.forEach((css, index) => {\n//     const result = extractFirstColorFromCSSBackground(css);\n//     console.log(`${index + 1}. ${css.substring(0, 50)}... -> ${result}`);\n//   });\n// }\nfunction hexToHSL(hex) {\n    if (!hex) {\n        return;\n    }\n    const r = parseInt(hex.substring(1, 3), 16) / 255;\n    const g = parseInt(hex.substring(3, 5), 16) / 255;\n    const b = parseInt(hex.substring(5, 7), 16) / 255;\n    const max = Math.max(r, g, b);\n    const min = Math.min(r, g, b);\n    const lightness = (max + min) / 2;\n    if (max === min) {\n        return {\n            h: 0,\n            s: 0,\n            l: lightness,\n        };\n    }\n    let hue = 0;\n    const delta = max - min;\n    const saturation = lightness > 0.5 ? delta / (2 - max - min) : delta / (max + min);\n    switch (max) {\n        case r:\n            hue = (g - b) / delta + (g < b ? 6 : 0);\n            break;\n        case g:\n            hue = (b - r) / delta + 2;\n            break;\n        case b:\n            hue = (r - g) / delta + 4;\n            break;\n    }\n    hue /= 6;\n    return {\n        h: hue,\n        s: saturation,\n        l: lightness,\n    };\n}\nfunction hexToOklch(hex) {\n    if (!hex)\n        return;\n    // 移除可能存在的 \'#\' 符号\n    hex = hex.replace(/^#/, "");\n    if (hex.length === 4)\n        hex = hex.substring(0, 3);\n    else if (hex.length === 8)\n        hex = hex.substring(0, 6);\n    if (hex.length === 3) {\n        hex = hex\n            .split("")\n            .map(function (c) {\n            return c + c;\n        })\n            .join("");\n    }\n    // 将 hex 转换为 RGB\n    let R = parseInt(hex.slice(0, 2), 16) / 255;\n    let G = parseInt(hex.slice(2, 4), 16) / 255;\n    let B = parseInt(hex.slice(4, 6), 16) / 255;\n    // 将 RGB 转换为线性 RGB\n    R = R > 0.04045 ? Math.pow((R + 0.055) / 1.055, 2.4) : R / 12.92;\n    G = G > 0.04045 ? Math.pow((G + 0.055) / 1.055, 2.4) : G / 12.92;\n    B = B > 0.04045 ? Math.pow((B + 0.055) / 1.055, 2.4) : B / 12.92;\n    // 将线性 RGB 转换为 XYZ\n    let x = 0.4124564 * R + 0.3575761 * G + 0.1804375 * B;\n    let y = 0.2126729 * R + 0.7151522 * G + 0.072175 * B;\n    let z = 0.0193339 * R + 0.119192 * G + 0.9503041 * B;\n    // 将 XYZ 转换为 LMS\n    let l = 0.8189330101 * x + 0.3618667424 * y - 0.1288597137 * z;\n    let m = 0.0329845436 * x + 0.9293118715 * y + 0.0361456387 * z;\n    let s = 0.0482003018 * x + 0.2643662691 * y + 0.633851707 * z;\n    // 应用非线性函数\n    l = Math.cbrt(l);\n    m = Math.cbrt(m);\n    s = Math.cbrt(s);\n    // 计算 OKLCH 的 L 值\n    let L = 0.2104542553 * l + 0.793617785 * m - 0.0040720468 * s;\n    // 计算 OKLCH 的 C 和 H 值\n    let a = 1.9779984951 * l - 2.428592205 * m + 0.4505937099 * s;\n    let b = 0.0259040371 * l + 0.7827717662 * m - 0.808675766 * s;\n    // 计算色度 (Chroma)\n    let C = Math.sqrt(a * a + b * b);\n    // 计算色相 (Hue)\n    let H = Math.atan2(b, a) * (180 / Math.PI);\n    if (H < 0) {\n        H += 360;\n    }\n    return { L, C, H };\n}\n\n\n//# sourceURL=webpack://asri/./src/util/colorTools.ts?')},"./src/util/electron.ts":(__unused_webpack_module,exports,__webpack_require__)=>{eval('\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.remote = void 0;\nconst rsc_1 = __webpack_require__(/*! ./rsc */ "./src/util/rsc.ts");\nexports.remote = rsc_1.environment.isInBrowser || rsc_1.environment.isMobile ? null : __webpack_require__(/*! @electron/remote */ "@electron/remote");\n\n\n//# sourceURL=webpack://asri/./src/util/electron.ts?')},"./src/util/interfaceState.ts":function(__unused_webpack_module,exports,__webpack_require__){eval('\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.wndElements = exports.debouncedUpdateTopbarOverflow = exports.doesTopBarOverflow = void 0;\nexports.updateTopbarOverflow = updateTopbarOverflow;\nexports.isDockLytPinned = isDockLytPinned;\nexports.isDockLytExpanded = isDockLytExpanded;\nexports.isDockHidden = isDockHidden;\nexports.hasDockb = hasDockb;\nexports.isFullScreen = isFullScreen;\nexports.isStatusHidden = isStatusHidden;\nexports.updateWndEls = updateWndEls;\nconst electron_1 = __webpack_require__(/*! ./electron */ "./src/util/electron.ts");\nconst misc_1 = __webpack_require__(/*! ./misc */ "./src/util/misc.ts");\nconst rsc_1 = __webpack_require__(/*! ./rsc */ "./src/util/rsc.ts");\n// top bar\nexports.doesTopBarOverflow = false;\nexports.debouncedUpdateTopbarOverflow = (0, misc_1.debounce)(updateTopbarOverflow);\nfunction updateTopbarOverflow() {\n    var _a, _b;\n    if (!rsc_1.asriDoms.toolbar)\n        return;\n    exports.doesTopBarOverflow = ((_a = rsc_1.asriDoms.toolbar) === null || _a === void 0 ? void 0 : _a.scrollWidth) > rsc_1.asriDoms.toolbar.clientWidth;\n    if (!((_b = rsc_1.asriDoms.barMore) === null || _b === void 0 ? void 0 : _b.classList.contains("fn__none"))) {\n        exports.doesTopBarOverflow = true;\n    }\n    // console.log(\'measure top bar overflow\')\n}\n// docks and panels\nfunction isDockLytPinned(dir) {\n    const dockLayoutEl = dir === "B" ? rsc_1.asriDoms.layoutDockB : dir === "L" ? rsc_1.asriDoms.layoutDockL : rsc_1.asriDoms.layoutDockR; // read properties directly to prevent \'undefined\' result after minimizing js\n    return !!(dockLayoutEl && !dockLayoutEl.classList.contains("layout--float"));\n}\nfunction isDockLytExpanded(dir) {\n    const dockLayoutEl = dir === "B" ? rsc_1.asriDoms.layoutDockB : dir === "L" ? rsc_1.asriDoms.layoutDockL : rsc_1.asriDoms.layoutDockR; // read properties directly to prevent \'undefined\' result after minimizing js\n    let size;\n    if (!dockLayoutEl)\n        return false;\n    if (dir === "B") {\n        size = dockLayoutEl.style.height;\n    }\n    else {\n        size = dockLayoutEl.style.width;\n    }\n    return !!(size && size !== "0px");\n}\nfunction isDockHidden(dir = "L") {\n    const dock = dir === "B" ? rsc_1.asriDoms.dockB : dir === "L" ? rsc_1.asriDoms.dockL : rsc_1.asriDoms.dockR; // read properties directly to prevent \'undefined\' result after minimizing js\n    return !!(dock && dock.classList.contains("fn__none"));\n    // uses right dock to calculate status bar position: https://github.com/mustakshif/Asri/issues/16\n}\n// export function isFloatDockLytHidden(el: HTMLElement): boolean {\n//     return !isDockLytPinned(el) && el?.style.cssText.includes(\'transform: translate\');\n// }\n// bottom dock\nfunction hasDockb() {\n    return __awaiter(this, void 0, void 0, function* () {\n        if (!rsc_1.asriDoms.dockB)\n            yield (0, misc_1.querySelectorAsync)(".layout__dockb");\n        return !!(rsc_1.asriDoms.dockB && !rsc_1.asriDoms.dockB.classList.contains("fn__none"));\n    });\n}\n// export function isLytDockbFloating() {\n//     let result = false;\n//     if (!env.isMobile) {\n//         const layouts = doms.layouts;\n//         const lytDockb = layouts?.querySelector(\'.layout__dockb\') as AsriDomsExtended;\n//         result = !!(layouts && lytDockb?.classList.contains(\'layout--float\') && lytDockb?.style.height !== "0px");\n//     }\n//     return result;\n// }\n// fullscreen state in macOS\nfunction isFullScreen() {\n    return !!(electron_1.remote && electron_1.remote.getCurrentWindow().isFullScreen());\n}\n// status bar\nfunction isStatusHidden() {\n    return !!(rsc_1.asriDoms.status && rsc_1.asriDoms.status.classList.contains("fn__none"));\n}\nexports.wndElements = document.querySelectorAll(\'.layout__center [data-type="wnd"]\');\n/**\n * update wnd elements, use before calcTabbarSpacings() and calcProtyleSpacings()\n */\nfunction updateWndEls() {\n    return __awaiter(this, void 0, void 0, function* () {\n        yield (0, misc_1.querySelectorAllAsync)(\'.layout__center [data-type="wnd"]\').then((els) => {\n            exports.wndElements = els;\n        });\n        return exports.wndElements;\n    });\n}\n\n\n//# sourceURL=webpack://asri/./src/util/interfaceState.ts?')},"./src/util/misc.ts":function(__unused_webpack_module,exports){eval('\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.pushUnique = pushUnique;\nexports.debounce = debounce;\nexports.throttle = throttle;\nexports.isOverlapping = isOverlapping;\nexports.isOverlappingAsync = isOverlappingAsync;\nexports.nodeListsHaveSameElements = nodeListsHaveSameElements;\nexports.querySelectorAsync = querySelectorAsync;\nexports.querySelectorAllAsync = querySelectorAllAsync;\nexports.getFocusedProtyleInfo = getFocusedProtyleInfo;\n/**\n * Pushes an item to the array if it is not already present.\n * @param {Array} arr - The array to push the item to.\n * @param {*} item - The item to push to the array.\n */\nfunction pushUnique(arr, item) {\n    if (!arr.includes(item)) {\n        arr.push(item);\n    }\n}\nfunction debounce(func, delay = 200) {\n    let timeoutId = null;\n    return ((...args) => {\n        if (timeoutId) {\n            clearTimeout(timeoutId);\n            // console.log(\'timeoutId cleared\', timeoutId)\n        }\n        timeoutId = setTimeout(() => {\n            func(...args);\n            // console.log(timeoutId)\n            timeoutId = null;\n        }, delay);\n    });\n}\nfunction throttle(func, limit = 200) {\n    let lastCall = 0;\n    let timeoutId = null;\n    let lastArgs = null;\n    return ((...args) => {\n        const now = Date.now();\n        if (now - lastCall >= limit) {\n            lastCall = now;\n            func(...args);\n        }\n        else {\n            lastArgs = args;\n            if (!timeoutId) {\n                timeoutId = setTimeout(() => {\n                    lastCall = Date.now();\n                    if (lastArgs)\n                        func(...lastArgs);\n                    timeoutId = null;\n                    lastArgs = null;\n                }, limit - (now - lastCall));\n            }\n        }\n    });\n}\n// export function asriModeTransition() {\n//     document.body.classList.add(\'asri-mode-transition\');\n//     setTimeout(() => {\n//         document.body.classList.remove(\'asri-mode-transition\');\n//     }, 350);\n// }\n/**\n * Check if two elements have overlapping parts.\n */\nfunction isOverlapping(el1, el2) {\n    if (!el1 || !el2) {\n        console.warn("isOverlapping called with null element");\n        return false;\n    }\n    let el1Rect, el2Rect;\n    el1Rect = el1.getBoundingClientRect();\n    el2Rect = el2.getBoundingClientRect();\n    const res = isRectOverlapping(el1Rect, el2Rect);\n    // console.log(\'measure isOverlapping\')\n    return res;\n}\nfunction isOverlappingAsync(el1, el2) {\n    return __awaiter(this, void 0, void 0, function* () {\n        if (!el1 || !el2) {\n            console.warn("isOverlapping called with null element");\n            return false;\n        }\n        return new Promise((resolve) => {\n            let el1Rect, el2Rect;\n            el1Rect = el1.getBoundingClientRect();\n            el2Rect = el2.getBoundingClientRect();\n            const res = isRectOverlapping(el1Rect, el2Rect);\n            // console.log(\'measure isOverlapping\')\n            resolve(res);\n        });\n    });\n}\nfunction isRectOverlapping(elementRect, targetRect) {\n    let result = false;\n    if (elementRect && targetRect) {\n        result =\n            elementRect.right > targetRect.left &&\n                elementRect.bottom > targetRect.top &&\n                elementRect.left < targetRect.left + targetRect.width &&\n                elementRect.top < targetRect.top + targetRect.height;\n    }\n    return result;\n}\nfunction nodeListsHaveSameElements(list1, list2) {\n    if (!list1.length || !list2.length)\n        return false;\n    const set1 = new Set(list1);\n    const set2 = new Set(list2);\n    if (set1.size !== set2.size) {\n        return false;\n    }\n    for (const item of set1) {\n        if (!set2.has(item)) {\n            return false;\n        }\n    }\n    // console.log(list1+\' and \'+list2 + \' have same elements\');\n    return true;\n}\nfunction querySelectorAsync(selector_1) {\n    return __awaiter(this, arguments, void 0, function* (selector, scope = document, trial = 10, timeout = 200) {\n        let n = 0;\n        while (n < trial) {\n            const element = scope.querySelector(selector);\n            if (element)\n                return element;\n            yield new Promise((resolve) => setTimeout(resolve, timeout));\n            n++;\n        }\n        // throw new Error(\'querySelectorPromise failed\');\n    });\n}\nfunction querySelectorAllAsync(selector_1) {\n    return __awaiter(this, arguments, void 0, function* (selector, scope = document, trial = 10, timeout = 200) {\n        let n = 0;\n        while (n < trial) {\n            const elements = scope.querySelectorAll(selector);\n            if (elements.length > 0)\n                return elements;\n            yield new Promise((resolve) => setTimeout(resolve, timeout));\n            n++;\n        }\n        // throw new Error(\'querySelectorAllPromise failed\');\n    });\n}\nfunction getFocusedProtyleInfo(docID_1) {\n    return __awaiter(this, arguments, void 0, function* (docID, waitForLoading = false) {\n        var _a;\n        const res = {\n            docID: docID || undefined,\n            isProtyle: false,\n            protyle: undefined,\n        };\n        if (!docID) {\n            // 获取当前聚焦的文档\n            const focusedDocTab = yield querySelectorAsync(".layout__center .layout-tab-bar .item--focus");\n            docID = (_a = focusedDocTab === null || focusedDocTab === void 0 ? void 0 : focusedDocTab.getAttribute("data-id")) !== null && _a !== void 0 ? _a : undefined;\n        }\n        if (!docID)\n            return res;\n        const curProtyle = document.querySelector(`.layout__center .layout-tab-container>.protyle[data-id="${docID}"]:not(.fn__none)`);\n        if (!curProtyle)\n            return res;\n        // 如果需要等待加载完成，则等待 data-loading="finished" 属性\n        if (waitForLoading) {\n            yield waitForProtyleLoaded(curProtyle);\n        }\n        res.isProtyle = true;\n        res.protyle = curProtyle;\n        res.docID = docID;\n        return res;\n    });\n}\n/**\n * 等待 protyle 元素加载完成（data-loading="finished"）\n * @param protyle - protyle 元素\n * @param maxWaitTime - 最大等待时间（毫秒），默认 5000ms\n * @returns Promise<boolean> - 是否成功等待到加载完成\n */\nfunction waitForProtyleLoaded(protyle_1) {\n    return __awaiter(this, arguments, void 0, function* (protyle, maxWaitTime = 5000) {\n        return new Promise((resolve) => {\n            // 如果已经加载完成，直接返回\n            if (protyle.getAttribute("data-loading") === "finished") {\n                resolve(true);\n                return;\n            }\n            let timeoutId;\n            // 创建 MutationObserver 监听属性变化\n            const observer = new MutationObserver((mutations) => {\n                for (const mutation of mutations) {\n                    if (mutation.type === "attributes" &&\n                        mutation.attributeName === "data-loading" &&\n                        mutation.target.getAttribute("data-loading") === "finished") {\n                        clearTimeout(timeoutId);\n                        observer.disconnect();\n                        resolve(true);\n                        return;\n                    }\n                }\n            });\n            // 开始观察属性变化\n            observer.observe(protyle, {\n                attributeFilter: ["data-loading"],\n            });\n            // 设置超时\n            timeoutId = setTimeout(() => {\n                observer.disconnect();\n                resolve(false); // 超时返回 false\n            }, maxWaitTime);\n        });\n    });\n}\n// function isChromiumV138() {\n//   return navigator.userAgent.includes("Chrome/138");\n// }\n// export function addChromiumV138FixVar() {\n//   if (isChromiumV138()) {\n//     cssVarManager.setProperty("--asri-ccff", "0.5");\n//   }\n// }\n// export function removeChromiumV138FixVar() {\n//   cssVarManager.removeProperty("--asri-ccff");\n// }\n\n\n//# sourceURL=webpack://asri/./src/util/misc.ts?')},"./src/util/rsc.ts":(__unused_webpack_module,exports)=>{eval('\nObject.defineProperty(exports, "__esModule", ({ value: true }));\nexports.environment = exports.asriDoms = void 0;\nconst ua = navigator.userAgent;\n// DOM cache using Map for better performance\nconst domCache = new Map();\n/**\n * Factory function to get DOM elements with caching\n * @param selector - CSS selector or element ID\n * @param useQuerySelector - Whether to use querySelector instead of getElementById\n * @returns Cached DOM element\n */\nfunction getDom(selector, useQuerySelector = false) {\n    if (!domCache.has(selector)) {\n        const element = useQuerySelector\n            ? document.querySelector(selector)\n            : document.getElementById(selector);\n        if (!element) {\n            throw new Error(`DOM element not found: ${selector}`);\n        }\n        domCache.set(selector, element);\n    }\n    return domCache.get(selector);\n}\nexports.asriDoms = {\n    get layouts() { return getDom("layouts"); },\n    get layoutCenter() { return getDom(".layout__center", true); },\n    get toolbar() { return getDom("toolbar"); },\n    get dockL() { return getDom("dockLeft"); },\n    get dockR() { return getDom("dockRight"); },\n    get dockB() { return getDom("dockBottom"); },\n    get status() { return getDom("status"); },\n    get layoutDockL() { return getDom(".layout__dockl", true); },\n    get layoutDockR() { return getDom(".layout__dockr", true); },\n    get layoutDockB() { return getDom(".layout__dockb", true); },\n    get barSync() { return getDom("barSync"); },\n    get barForward() { return getDom("barForward"); },\n    get toolbarVIP() { return getDom("toolbarVIP"); },\n    get drag() { return getDom("drag"); },\n    get barPlugins() { return getDom("barPlugins"); },\n    get barSearch() { return getDom("barSearch"); },\n    get barMode() { return getDom("barMode"); },\n    get barMore() { return getDom("barMore"); },\n};\nexports.environment = {\n    isMacOS: navigator.platform.indexOf("Mac") > -1,\n    isWindows: window.siyuan.config.system.os === "windows",\n    isLinux: navigator.platform.indexOf("Linux") > -1,\n    isAndroid: /Android/.test(ua),\n    isMobile: !!document.getElementById("sidebar"),\n    isInBrowser: !ua.startsWith("SiYuan") || ua.indexOf("iPad") > -1 || (/Android/.test(ua) && !/(?:Mobile)/.test(ua)), // tablets use this too\n    isMiniWindow: document.body.classList.contains("body--window"),\n    isIOSApp: (/iOS/i.test(ua) || /iPad/i.test(ua)) && /AppleWebKit/i.test(ua) && ua.startsWith("SiYuan/"),\n    lang: window.siyuan.config.lang,\n    supportOklch: CSS.supports("color", "oklch(from red calc(l * 0.5) 0 h)"),\n    isReadOnly: window.siyuan.config.readonly,\n    appSchemeMode: window.siyuan.config.appearance.mode > 0 ? "dark" : "light",\n    isFollowSysMode: window.siyuan.config.appearance.modeOS,\n    isSafari: /^((?!chrome|android).)*safari/i.test(ua),\n};\n\n\n//# sourceURL=webpack://asri/./src/util/rsc.ts?')},"@electron/remote":e=>{e.exports=require("@electron/remote")}},__webpack_module_cache__={};function __webpack_require__(e){var n=__webpack_module_cache__[e];if(void 0!==n)return n.exports;var t=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(t.exports,t,t.exports,__webpack_require__),t.exports}__webpack_require__.d=(e,n)=>{for(var t in n)__webpack_require__.t(n,t)&&!__webpack_require__.t(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},__webpack_require__.t=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__=__webpack_require__("./src/main.ts")})();